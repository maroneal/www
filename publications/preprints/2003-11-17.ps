%!PS-Adobe-2.0
%%Creator: dvips(k) 5.86 Copyright 1999 Radical Eye Software
%%Title: paper.dvi
%%Pages: 19
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Palatino-Bold Palatino-Roman Courier Palatino-Italic
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -f paper.dvi
%DVIPSParameters: dpi=600, compressed
%DVIPSSource:  TeX output 2003.11.17:1344
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "22 June 1996",
%   filename = "8r.enc",
%   email = "kb@@mail.tug.org",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "119     662    4424",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type/integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics/Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{
dup sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1
roll mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def
dup[exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}
if}forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}
def end

%%EndProcSet
%%BeginProcSet: special.pro
%!
TeXDict begin/SDict 200 dict N SDict begin/@SpecialDefaults{/hs 612 N
/vs 792 N/ho 0 N/vo 0 N/hsc 1 N/vsc 1 N/ang 0 N/CLIP 0 N/rwiSeen false N
/rhiSeen false N/letter{}N/note{}N/a4{}N/legal{}N}B/@scaleunit 100 N
/@hscale{@scaleunit div/hsc X}B/@vscale{@scaleunit div/vsc X}B/@hsize{
/hs X/CLIP 1 N}B/@vsize{/vs X/CLIP 1 N}B/@clip{/CLIP 2 N}B/@hoffset{/ho
X}B/@voffset{/vo X}B/@angle{/ang X}B/@rwi{10 div/rwi X/rwiSeen true N}B
/@rhi{10 div/rhi X/rhiSeen true N}B/@llx{/llx X}B/@lly{/lly X}B/@urx{
/urx X}B/@ury{/ury X}B/magscale true def end/@MacSetUp{userdict/md known
{userdict/md get type/dicttype eq{userdict begin md length 10 add md
maxlength ge{/md md dup length 20 add dict copy def}if end md begin
/letter{}N/note{}N/legal{}N/od{txpose 1 0 mtx defaultmatrix dtransform S
atan/pa X newpath clippath mark{transform{itransform moveto}}{transform{
itransform lineto}}{6 -2 roll transform 6 -2 roll transform 6 -2 roll
transform{itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll
curveto}}{{closepath}}pathforall newpath counttomark array astore/gc xdf
pop ct 39 0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}
if}N/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1
-1 scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3
get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip
yflip not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub
neg 0 TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{
noflips{TR pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop
90 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get
neg sub neg TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr
1 get neg sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr
2 get ppr 0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4
-1 roll add 2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S
TR}if}N/cp{pop pop showpage pm restore}N end}if}if}N/normalscale{
Resolution 72 div VResolution 72 div neg scale magscale{DVImag dup scale
}if 0 setgray}N/psfts{S 65781.76 div N}N/startTexFig{/psf$SavedState
save N userdict maxlength dict begin/magscale true def normalscale
currentpoint TR/psf$ury psfts/psf$urx psfts/psf$lly psfts/psf$llx psfts
/psf$y psfts/psf$x psfts currentpoint/psf$cy X/psf$cx X/psf$sx psf$x
psf$urx psf$llx sub div N/psf$sy psf$y psf$ury psf$lly sub div N psf$sx
psf$sy scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub
TR/showpage{}N/erasepage{}N/copypage{}N/p 3 def @MacSetUp}N/doclip{
psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll newpath 4 copy 4 2
roll moveto 6 -1 roll S lineto S lineto S lineto closepath clip newpath
moveto}N/endTexFig{end psf$SavedState restore}N/@beginspecial{SDict
begin/SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count/ocount X/dcount countdictstack N}N/@setspecial{
CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto
closepath clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx
sub div rhiSeen{rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR
}{rhiSeen{rhi ury lly sub div dup scale llx neg lly neg TR}if}ifelse
CLIP 2 eq{newpath llx lly moveto urx lly lineto urx ury lineto llx ury
lineto closepath clip}if/showpage{}N/erasepage{}N/copypage{}N newpath}N
/@endspecial{count ocount sub{pop}repeat countdictstack dcount sub{end}
repeat grestore SpecialSave restore end}N/@defspecial{SDict begin}N
/@fedspecial{end}B/li{lineto}B/rl{rlineto}B/rc{rcurveto}B/np{/SaveX
currentpoint/SaveY X N 1 setlinecap newpath}N/st{stroke SaveX SaveY
moveto}N/fil{fill SaveX SaveY moveto}N/ellipse{/endangle X/startangle X
/yrad X/xrad X/savematrix matrix currentmatrix N TR xrad yrad scale 0 0
1 startangle endangle arc savematrix setmatrix}N end

%%EndProcSet
TeXDict begin 39158280 55380996 1000 600 600 (paper.dvi)
@start /Fa 134[37 2[37 42 25 29 29 1[37 33 42 58 21 33
21 21 37 37 21 29 37 30 35 33 9[71 2[46 42 2[46 58 58
71 42 1[25 25 1[54 42 46 58 50 46 54 6[19 37 4[37 37
37 37 37 22 1[25 19 2[25 25 21 36[39 2[{TeXBase1Encoding ReEncodeFont}
53 74.7198 /Palatino-Italic rf /Fb 166[40 1[60 43 47
37 31 40 2[47 50 57 37 43 1[20 50 46 33 37 46 42 1[47
65[{TeXBase1Encoding ReEncodeFont}20 59.7758 /Palatino-Roman
rf
%DVIPSBitmapFont: Fc cmr7 7 3
/Fc 3 51 df<EB3F803801FFF03803E0F83807803C48487E001E7F003E1480A2003C1307
007C14C0A400FC14E0AE007C14C0A36CEB0F80A36CEB1F006C131E6C6C5A3803E0F86CB4
5A38003F801B277EA521>48 D<13381378EA01F8121F12FE12E01200B3AB487EB512F8A2
15267BA521>I<13FF000313E0380E03F0381800F848137C48137E00787F12FC6CEB1F80
A4127CC7FC15005C143E147E147C5C495A495A5C495A010EC7FC5B5B903870018013E0EA
0180390300030012065A001FB5FC5A485BB5FCA219267DA521>I
E
%EndDVIPSBitmapFont
%DVIPSBitmapFont: Fd cmr10 10 6
/Fd 6 94 df<146014E0EB01C0EB0380EB0700130E131E5B5BA25B485AA2485AA212075B
120F90C7FCA25A121EA2123EA35AA65AB2127CA67EA3121EA2121F7EA27F12077F1203A2
6C7EA26C7E1378A27F7F130E7FEB0380EB01C0EB00E01460135278BD20>40
D<12C07E12707E7E7E120F6C7E6C7EA26C7E6C7EA21378A2137C133C133E131EA2131F7F
A21480A3EB07C0A6EB03E0B2EB07C0A6EB0F80A31400A25B131EA2133E133C137C1378A2
5BA2485A485AA2485A48C7FC120E5A5A5A5A5A13527CBD20>I<121C127FEAFF80A5EA7F
00121CC7FCB2121C127FEAFF80A5EA7F00121C092479A317>58 D<007FB812F8B912FCA2
6C17F8CCFCAE007FB812F8B912FCA26C17F836167B9F41>61 D<EAFFF8A4EAF000B3B3B3
B3A3EAFFF8A40D5378BD17>91 D<EAFFF8A4EA0078B3B3B3B3A3EAFFF8A40D537FBD17>
93 D E
%EndDVIPSBitmapFont
%DVIPSBitmapFont: Fe cmmi10 10 7
/Fe 7 121 df<133F14C0EB07F06D7E801301A26D7EA3147FA36E7EA36E7EA36E7EA36E
7EA36E7EA36E7EA26E7EA214014A7E5C4A7E91381E3F80143C14784A6C7E1301EB03E049
486C7EEB0F80EB1F00496D7E137E5B48486D7E485A485A000F6E7E485A485A48C87E12FE
167F4816800070151F293B7CB930>21 D<121C127FEAFF80A5EA7F00121C0909798817>
58 D<14E0EB03F8A21307A314F0EB01C090C7FCAB13F8EA03FEEA070F000E1380121C12
1812381230EA701F1260133F00E0130012C05BEA007EA213FE5B1201A25B12035BA20007
131813E01438000F133013C01470EB806014E014C01381EB838038078700EA03FEEA00F8
15397EB71D>105 D<D803E0137F3A07F801FFE03A0E3C0781F03A1C3E1E00F826383F38
7F00305B4A137C00705B00605BA200E090C712FC485A137EA20000140101FE5C5BA21503
00015D5B15075E120349010F133016C0031F13700007ED80605B17E0EE00C0000F150149
15801603EE0700001FEC0F0E49EB07FC0007C7EA01F02C267EA432>110
D<14FF010313C090380F80F090383E00380178131C153C4913FC0001130113E0A33903F0
00F06D13007F3801FFE014FC14FF6C14806D13C0011F13E013039038003FF01407140300
1E1301127FA24814E0A348EB03C012F800E0EB07800070EB0F006C133E001E13F83807FF
E0000190C7FC1E267CA427>115 D<01F8EB03C0D803FEEB07E0D8070F130F000E018013
F0121C12180038140700301403D8701F130112601500D8E03F14E000C090C7FC5BEA007E
16C013FE5B1501000115805B150316001203495B1506150E150C151C151815385D00015C
6D485A6C6C485AD97E0FC7FCEB1FFEEB07F024267EA428>118 D<903907E001F090391F
F807FC9039783E0E0F9039E01F1C1FD801C09038383F803A03800FF07F0100EBE0FF5A00
0E4A1300000C157E021F133C001C4AC7FC1218A2C7123FA292C8FCA25CA2147EA214FEA2
4A130CA20101141C001E1518003F5BD87F81143801835C00FF1560010714E03AFE0E7C01
C0D87C1C495A2778383E0FC7FC391FF00FFC3907C003F029267EA42F>120
D E
%EndDVIPSBitmapFont
/Ff 202[25 25 25 25 25 49[{TeXBase1Encoding ReEncodeFont}5
49.8132 /Palatino-Roman rf /Fg 202[29 29 29 29 29 49[{
TeXBase1Encoding ReEncodeFont}5 58.1154 /Palatino-Roman
rf
%DVIPSBitmapFont: Fh cmmi6 6 1
/Fh 1 64 df<1308A4131CA500C0EB0180397FBEFF00381FFFFC000713F0000113C06C6C
C7FCA2497E13F73801E3C013C1380380E0EB006000067F00041310487F19197D9820>63
D E
%EndDVIPSBitmapFont
/Fi 103[50 30[50 50 50 50 50 50 50 50 1[50 50 50 50 50
50 1[50 50 50 50 50 50 50 50 50 1[50 1[50 1[50 1[50 5[50
4[50 7[50 1[50 5[50 50 50 2[50 50 50 50 50 50 50 50 50
50 50 50 50 50 50 50 50 50 50 3[50 50 50 33[{
TeXBase1Encoding ReEncodeFont}57 83.022 /Courier rf /Fj
105[42 27[42 46 42 2[51 28 37 32 1[51 46 51 74 28 51
1[28 1[46 32 42 51 37 51 42 11[65 1[51 60 1[51 69 1[83
3[32 1[69 2[69 60 55 65 13[42 42 42 2[21 46[{
TeXBase1Encoding ReEncodeFont}38 83.022 /Palatino-Bold
rf /Fk 107[42 42 25[42 42 60 42 46 28 32 32 1[42 37 46
65 23 37 1[23 42 42 23 32 42 34 38 37 3[28 1[28 7[46
9[28 5[55 1[60 6[21 42 7[42 3[28 3[28 28 37[44 2[{
TeXBase1Encoding ReEncodeFont}38 83.022 /Palatino-Italic
rf /Fl 136[83 1[61 33 44 39 1[61 55 61 89 33 2[33 61
55 39 50 61 44 61 50 9[100 1[78 66 61 72 1[61 2[100 61
2[39 83 1[55 1[83 4[44 10[50 50 50 50 49[{TeXBase1Encoding ReEncodeFont}
36 99.6264 /Palatino-Bold rf /Fm 139[25 33 29 14[33 46
37 31[58 18[19 46[{TeXBase1Encoding ReEncodeFont}8 74.7198
/Palatino-Bold rf /Fn 103[45 27[45 1[45 45 45 45 45 45
45 45 45 1[45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 1[45 1[45 1[45 1[45 2[45 1[45 45 45 1[45 1[45 45
1[45 1[45 3[45 45 2[45 45 1[45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 3[45 45
45 33[{TeXBase1Encoding ReEncodeFont}71 74.7198 /Courier
rf /Fo 75[25 11[25 17[37 1[37 37 24[37 42 39 62 42 45
24 32 30 42 45 41 43 66 22 42 17 22 43 42 25 36 46 33
41 37 3[25 1[25 50 50 50 75 54 58 46 39 50 1[45 59 62
71 46 54 25 25 62 57 42 46 58 53 46 58 6[19 37 37 37
37 37 37 37 37 37 37 1[19 25 19 2[25 25 23[25 12[45 45
2[{TeXBase1Encoding ReEncodeFont}77 74.7198 /Palatino-Roman
rf /Fp 107[42 42 24[42 46 43 69 47 50 27 35 33 46 50
45 48 73 24 46 19 24 48 46 28 40 51 37 46 42 3[28 1[28
1[55 1[83 60 65 51 44 55 1[50 65 69 79 51 60 28 28 69
63 46 51 64 59 51 65 1[37 1[50 2[21 42 42 42 42 42 42
42 42 42 42 1[21 28 21 50 1[28 28 23 1[70 33[50 50 2[{
TeXBase1Encoding ReEncodeFont}76 83.022 /Palatino-Roman
rf
%DVIPSBitmapFont: Fq cmmib10 10 1
/Fq 1 64 df<14035CA34A7EA54A7EA60070496C1370D8FFF0EC7FF890B7FC003F16E06C
16C000071600000115FC6C6C14F0011F14C0010791C7FC010113FCA2497FA3497F14FDD9
0FF87FECF07F49486C7EECC01F49486C7EEC0007017E6D7E017C130101F0EB0078491438
014014102D2B7FA930>63 D E
%EndDVIPSBitmapFont
/Fr 138[73 40 53 47 2[66 73 106 40 2[40 1[66 1[60 73
53 1[60 16[73 2[120 3[47 1[100 5[93 19[40 45[{
TeXBase1Encoding ReEncodeFont}20 119.552 /Palatino-Bold
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: A4

%%EndSetup
%%Page: 1 1
1 0 bop 542 451 a Fr(A)30 b(Gentle)e(Introduction)i(to)g(Multi-stage)f
(Programming)3334 408 y Fq(?)1758 740 y Fp(W)-8 b(alid)21
b(T)-8 b(aha)817 914 y Fo(Department)20 b(of)e(Computer)g(Science,)h
(Rice)f(University)-8 b(,)17 b(Houston,)i(TX,)f(USA)1673
1005 y Fn(taha@rice.edu)759 1321 y Fm(Abstract.)42 b
Fo(Multi-stage)18 b(pr)o(ogramming)f(\(MSP\))i(is)g(a)g(paradigm)g(for)
f(developing)759 1412 y(generic)23 b(softwar)o(e)f(that)j(does)d(not)i
(pay)f(a)h(r)o(untime)f(penalty)h(for)e(this)h(generality)-8
b(.)759 1503 y(This)18 b(is)f(achieved)h(thr)o(ough)g(concise,)g(car)o
(efully-designed)c(language)k(extensions)759 1594 y(that)k(support)e(r)
o(untime)h(code)f(generation)h(and)g(pr)o(ogram)e(execution.)h
(Addition-)759 1686 y(ally)-8 b(,)14 b(type)h(systems)f(for)h(MSP)g
(languages)g(ar)o(e)g(designed)f(to)h(statically)h(ensur)o(e)e(that)759
1777 y(dynamically)23 b(generated)f(pr)o(ograms)f(ar)o(e)i(type)f
(safe,)h(and)g(ther)o(efor)o(e)f(r)o(equir)o(e)e(no)759
1868 y(type)f(checking)f(after)h(they)g(ar)o(e)f(generated.)759
1958 y(This)f(hands-on)g(tutorial)g(is)f(aimed)g(at)h(the)g(r)o(eader)e
(inter)o(ested)h(in)h(learning)f(the)h(ba-)759 2049 y(sics)h(of)g(MSP)g
(practice.)g(The)g(tutorial)h(uses)e(a)i(fr)o(eely)d(available)j(MSP)f
(extension)g(of)759 2140 y(OCaml)j(called)g(MetaOCaml,)g(and)h(pr)o
(esents)e(a)h(detailed)g(analysis)f(of)h(the)h(issues)759
2232 y(that)17 b(arise)d(in)h(staging)f(an)i(interpr)o(eter)d(for)h(a)h
(small)f(pr)o(ogramming)f(language.)i(The)759 2323 y(tutorial)22
b(concludes)g(with)h(pointers)e(to)h(various)f(r)o(esour)o(ces)f(that)j
(can)g(be)f(used)g(to)759 2414 y(pr)o(obe)c(further)g(into)h(r)o
(elated)f(topics.)523 2685 y Fl(1)99 b(Introduction)523
2875 y Fp(Although)30 b(pr)o(ogram)f(generation)g(has)g(been)g(shown)i
(to)e(impr)o(ove)g(code)g(r)o(euse,)f(pr)o(od-)523 2975
y(uct)j(r)o(eliability)f(and)g(maintainability)-9 b(,)31
b(performance)e(and)h(r)o(esour)o(ce)g(utilization,)g(and)523
3074 y(developer)g(pr)o(oductivity)-9 b(,)29 b(ther)o(e)h(is)g(little)h
(support)g(for)f Fk(writing)g Fp(generators)g(in)h(main-)523
3174 y(str)o(eam)d(languages)h(such)g(as)g(C)g(or)g(Java.)e(Y)-8
b(et)30 b(a)e(host)i(of)f(basic)g(pr)o(oblems)f(inher)o(ent)h(in)523
3274 y(pr)o(ogram)24 b(generation)g(can)g(be)g(addr)o(essed)f(ef)o
(fectively)f(by)j(a)f(pr)o(ogramming)g(language)523 3373
y(designed)d(speci\002cally)f(to)h(support)g(writing)h(generators.)523
3613 y Fj(1.1)82 b(Basic)20 b(Problems)f(in)h(Building)g(Program)h
(Generators)523 3771 y Fp(In)e(a)f(general-purpose)g(language,)g(we)h
(typically)g(r)o(epr)o(esent)e(the)i(pr)o(ogram)f(\(fragments\))523
3870 y(we)f(want)g(to)h(generate)e(as)h(either)g(strings)h(or)g(data)e
(types)h(\(\223abstract)e(syntax)i(tr)o(ees\224\).)e(Un-)523
3970 y(fortunately)-9 b(,)17 b(both)g(r)o(epr)o(esentations)f(have)h
(disadvantages.)e(W)-5 b(ith)19 b(the)e(string)h(encoding,)523
4069 y(we)28 b(r)o(epr)o(esent)f(the)h(code)g(fragment)f
Fi(f)50 b(\(x,y\))27 b Fp(simply)i(as)f Fi("f)49 b(\(x,y\)")p
Fp(.)27 b(While)i(con-)523 4169 y(str)o(ucting)k(and)f(combining)i
(fragments)e(r)o(epr)o(esented)e(by)i(strings)h(can)f(be)f(done)i(con-)
523 4269 y(cisely)-9 b(.)36 b(Mor)o(e)f(seriously)-9
b(,)36 b(ther)o(e)f(is)h(no)h Fk(automatically)d(veri\002able)i
Fp(guarantee)f(that)h(pr)o(o-)523 4368 y(grams)19 b(thusly)g(constr)o
(ucted)h(ar)o(e)d(syntactically)i(corr)o(ect.)e(For)i(example,)f
Fi("f)49 b(\(,y\)")18 b Fp(can)523 4468 y(have)j(the)h(static)f(type)g
Fi(string)p Fp(,)f(but)i(this)g(string)g(is)g(clearly)e
Fk(not)h Fp(a)g(syntactically)h(corr)o(ect)523 4568 y(pr)o(ogram.)648
4667 y(W)-5 b(ith)24 b(the)f(data)f(type)h(encoding)g(the)g(situation)h
(is)g(impr)o(oved,)e(but)h(the)g(best)g(we)g(can)523
4767 y(do)33 b(is)h(ensur)o(e)e(that)h(any)g(generated)f(pr)o(ogram)h
(is)g(syntactically)g(corr)o(ect.)f(W)-8 b(e)34 b(cannot)p
523 4839 473 4 v 551 4893 a Fh(?)606 4924 y Fo(Supported)18
b(by)g(NSF)h(ITR-0113569)i(and)e(NSF)g(CCR-0205542.)p
eop
%%Page: 2 2
2 1 bop 523 448 a Fp(use)28 b(data)e(types)i(to)g(ensur)o(e)f(that)g
(generated)g(pr)o(ograms)g(ar)o(e)f(well-typed.)h(The)h(r)o(eason)523
548 y(is)i(that)f(data)f(types)h(can)g(r)o(epr)o(esent)f(context-fr)o
(ee)f(sets)j(accurately)-9 b(,)27 b(but)i(\(usually\))g(not)523
648 y(context)e(sensitive)g(sets.)g(T)-7 b(ype)26 b(systems)i
(generally)e(de\002ne)h(context)g(sensitive)g(sets)g(\(of)523
747 y(pr)o(ograms\).)21 b(Additionally)-9 b(,)21 b(constr)o(ucting)i
(data)d(type)i(values)f(that)h(r)o(epr)o(esent)e(tr)o(ees)g(is)i(a)523
847 y(bit)f(mor)o(e)f(verbose.)648 948 y(MSP)g(languages)h(pr)o(ovide)f
(concise)i(syntax)f(similar)g(to)h(that)f(used)g(to)g(build)g(strings.)
523 1047 y(In)i(contrast)h(to)f(strings,)h(MSP)f(languages)g
(statically)g(ensur)o(e)f(that)h(any)g(generator)g(only)523
1147 y(pr)o(oduces)15 b(syntactically)h(well-formed)f(pr)o(ograms.)g
(Additionally)-9 b(,)16 b(statically)f(typed)h(MSP)523
1247 y(languages)23 b(statically)g(ensur)o(e)g(that)g(any)g(generated)f
(pr)o(ogram)h(is)g(also)h(type)f(corr)o(ect.)f(In)523
1346 y(such)e(languages,)f(any)h(statically)f(well-typed)g(pr)o(ogram)g
(generator)g(can)g(only)i(generate)523 1446 y(well-typed)f(pr)o
(ograms.)648 1547 y(Finally)-9 b(,)24 b(with)g(both)h(string)f(and)f
(data)g(type)h(r)o(epr)o(esentations,)e(ensuring)j(that)f(ther)o(e)523
1646 y(ar)o(e)k(no)i(name)f(clashes)g(or)g(inadvertent)g(variable)f
(captur)o(es)f Fk(in)j(the)e(generated)h(pr)o(ogram)523
1746 y Fp(is)g(the)h(r)o(esponsibility)g(of)f(the)g(pr)o(ogrammer)-6
b(.)28 b(This)h(is)h(essentially)f(the)g(same)g(pr)o(oblem)523
1846 y(that)21 b(one)g(encounters)g(with)h(the)e(C)h(macr)o(o)f
(system.)h(MSP)f(languages)h(ensur)o(e)f(that)g(such)523
1945 y(inadvertent)j(captur)o(e)g(is)h(not)g(possible.)g(W)-8
b(e)24 b(will)h(r)o(eturn)e(to)h(this)h(issue)f(when)h(we)e(have)523
2045 y(discussed)e(some)g(mor)o(e)g(examples)f(of)g(MSP)-11
b(.)523 2300 y Fj(1.2)82 b(Basic)20 b(MSP)g(Constructs)g(in)g
(MetaOCaml)523 2472 y Fp(T)-8 b(o)27 b(illustrate)g(how)h(MSP)e(addr)o
(esses)f(the)i(above)f(pr)o(oblems)h(we)f(consider)h(a)g(small)g(ex-)
523 2572 y(ample)j(in)g(MetaOCaml.)f(MetaOCaml)g([1)o(])g(is)i(an)f
(MSP)f(extension)h(of)g(the)h(functional)523 2672 y(pr)o(ogramming)19
b(language)f(OCaml)h([7)o(].)f(In)h(addition)g(to)g(containing)g
(traditional)g(imper)o(-)523 2771 y(ative,)g(object-oriented,)g(and)g
(functional)h(featur)o(es,)e(MetaOCaml)g(pr)o(ovides)h(constr)o(ucts)
523 2871 y(for)27 b(staging.)h Fk(Staging)f Fp(a)g(pr)o(ogram)f(is)i
(modifying)h(it)e(so)h(that)g(the)g(work)g(it)f(performs)h(is)523
2970 y(carried)d(out)h(in)g(discr)o(ete)f(stages.)h(This)g(is)h(done)f
(with)h(the)f(goal)g(of)g(impr)o(oving)g(overall)523
3070 y(performance.)648 3163 y(MetaOCaml)g(has)h(thr)o(ee)g(staging)g
(constr)o(ucts.)h(Brackets)f(can)g(be)g(inserted)g(ar)o(ound)523
3254 y(any)19 b(expr)o(ession)g(to)h(delay)f(its)h(execution.)f
(MetaOCaml)f(implements)i(delayed)f(expr)o(es-)523 3345
y(sions)e(by)g(dynamically)f(generating)g(sour)o(ce)g(code)g(at)g(r)o
(untime.)g(While)h(using)g(the)f(sour)o(ce)523 3437 y(code)24
b(r)o(epr)o(esentation)g(is)h(not)g(the)g(only)h(way)f(of)f
(implementing)i(MSP)e(languages,)h(it)g(is)523 3528 y(the)e(simplest.)h
(The)f(following)h(short)g(interactive)e(session)i(illustrates)f(the)g
(behavior)g(of)523 3619 y(Brackets)d(in)h(MetaOCaml:)523
3782 y Fn(#)45 b(let)f(a)h(=)f(1+2;;)523 3873 y(val)g(a)h(:)g(int)f(=)h
(3)523 3965 y(#)g(let)f(a)h(=)f(.<1+2>.;;)523 4056 y(val)g(a)h(:)g(int)
f(code)g(=)h(.<1+2>.)523 4226 y Fp(Lines)21 b(that)f(start)g(with)h
Fi(#)f Fp(ar)o(e)f(what)i(is)g(enter)o(ed)e(by)h(the)h(user)-6
b(,)20 b(and)g(the)g(following)i(line\(s\))523 4325 y(ar)o(e)h(what)i
(is)f(printed)h(back)e(by)i(the)g(system.)f(W)-5 b(ithout)26
b(the)f(Brackets)e(ar)o(ound)h Fi(1+2)p Fp(,)g(the)523
4425 y(addition)18 b(is)g(performed)e(right)i(away)-9
b(.)17 b(W)-5 b(ith)18 b(the)g(Brackets,)f(the)g(r)o(esult)h(is)g(a)f
(piece)g(of)g(code)523 4525 y(r)o(epr)o(esenting)h(the)h(pr)o(ogram)f
Fi(1+2)p Fp(.)h(This)g(code)g(fragment)f(can)h(either)g(be)f(used)h(as)
g(part)f(of)523 4624 y(another)-6 b(,)21 b(bigger)f(pr)o(ogram,)g(or)h
(it)g(can)f(be)h(compiled)g(and)f(executed.)648 4725
y(In)27 b(addition)g(to)h(delaying)f(the)g(computation,)h(Brackets)e
(ar)o(e)g(also)h(r)o(e\003ected)f(in)i(the)523 4825 y(type.)21
b(The)g(type)f(in)i(the)f(last)g(declaration)f(is)h Fi(int)50
b(code)p Fp(,)20 b(r)o(ead)f Fk(\223Code)h(of)h(Int\224)p
Fp(.)f(The)h(type)523 4924 y(of)g(a)g(code)g(fragment)g(r)o(e\003ects)g
(the)g(type)h(of)f(the)g(value)g(that)g(such)h(code)f(would)h(pr)o
(oduce)1943 5173 y(2)p eop
%%Page: 3 3
3 2 bop 523 448 a Fp(when)29 b(it)g(is)h(executed.)d(This)i(allows)h
(us)f(to)g(avoid)f(writing)i(generators)e(that)h(pr)o(oduce)523
548 y(code)17 b(that)f(cannot)h(be)g(typed.)f(The)h(code)f(type)h
(constr)o(uctor)h(distinguishes)g(delayed)e(val-)523
648 y(ues)24 b(fr)o(om)g(other)h(values)f(and)g(pr)o(events)f(the)i
(user)f(fr)o(om)g(accidentally)f(attempting)i(un-)523
747 y(safe)e(operations)i(\(such)f(as)g Fi(1)50 b(+)f(.<5>.)p
Fp(\).)23 b(Note)h(also)h(that)f(when)h(typing)g(multi-stage)523
847 y(languages)17 b(one)g(must)g(ensur)o(e)f(that)h(no)g(attempt)f(is)
h(ever)f(made)g(to)h(use)g(a)f(variable)f(befor)o(e)523
946 y(its)21 b(value)f(becomes)h(available.)648 1038
y(Escape)c(allows)j(the)e(combination)i(of)f(smaller)g(delayed)e
(values)i(to)g(constr)o(uct)g(lar)o(ger)523 1130 y(ones.)g(This)h
(combination)g(is)f(achieved)f(by)h(\223splicing-in\224)g(the)g(ar)o
(gument)f(of)h(the)g(Escape)523 1221 y(in)i(the)g(context)g(of)g(the)g
(surr)o(ounding)g(Brackets:)523 1381 y Fn(#)45 b(let)f(b)h(=)f
(.<.\230a)g(*)h(.\230a)f(>.)h(;;)523 1472 y(val)f(b)h(:)g(int)f(code)g
(=)h(.<\(1)f(+)h(2\))f(*)h(\(1)f(+)h(2\)>.)523 1640 y
Fp(This)21 b(declaration)e(binds)i Fi(b)e Fp(to)i(a)f(new)g(delayed)f
(computation)i Fi(\(1+2\)*\(1+2\))p Fp(.)d(Escape)523
1740 y(combines)i(delayed)f(computations)h(ef)o(\002ciently)g(in)g(the)
f(sense)h(that)f(the)h(combination)h(of)523 1839 y(the)j(subcomponents)
h(of)e(the)h(new)g(computation)g(is)g(performed)f(while)h(the)g(new)g
(com-)523 1939 y(putation)h(is)g(being)g Fk(constructed)p
Fp(,)f(rather)g(than)h(while)g(it)g(is)g(being)h Fk(executed)p
Fp(.)d(This)j(subtle)523 2039 y(distinction)21 b(has)f(a)g
(signi\002cant)h(ef)o(fect)d(on)i(the)g(r)o(untime)h(performance)e(of)h
(the)g(generated)523 2138 y(code.)648 2230 y(The)g(Run)h(constr)o(uct)g
(\(written)g Fi(.!)p Fp(\))e(allows)i(us)g(to)g(execute)e(the)i
(dynamically)f(gener)o(-)523 2321 y(ated)g(code)g(without)i(going)g
(outside)f(the)g(language:)523 2481 y Fn(#)45 b(let)f(c)h(=)f(.!)h(b;;)
523 2573 y(val)f(c)h(:)g(int)f(=)h(9)523 2741 y Fp(Having)28
b(these)f(thr)o(ee)g(constr)o(ucts)h(as)g(part)e(of)i(the)f(pr)o
(ogramming)h(language)f(makes)h(it)523 2840 y(possible)22
b(to)g(use)g(r)o(untime)g(code)g(generation)f(and)g(compilation)i(as)e
(part)g(of)h(any)f(library)523 2940 y(subr)o(outine.)34
b(In)f(addition)h(to)g(not)g(having)g(to)g(worry)g(about)g(generating)f
(temporary)523 3039 y(\002les,)26 b(static)g(type)g(systems)h(for)f
(MSP)f(languages)h(can)f(assur)o(e)h(us)g(that)g(no)g(r)o(untime)h(er)o
(-)523 3139 y(r)o(ors)c(will)h(occur)f(in)g(these)h(subr)o(outines)f
(\(c.f.)f([14)o(]\).)g(Not)i(only)g(can)f(these)g(type)g(systems)523
3239 y(exclude)i(generation-time)h(err)o(ors,)f(but)h(they)h(also)f
(ensur)o(e)g(that)g(generated)e(pr)o(ograms)523 3338
y(ar)o(e)f(both)i(syntactically)f(well-formed)g(and)g(well-typed.)f
(Ther)o(efor)o(e,)f(the)j(dynamic)f(in-)523 3438 y(vocation)d(of)g(the)
g(compiler)g(cannot)g(fail.)648 3530 y(Finally)-9 b(,)25
b(it)g(is)g(important)g(to)h(note)f(that)g(pr)o(ogram)f(generation)h(r)
o(equir)o(es)f(r)o(enaming.)523 3621 y(Consider)d(the)g(following)h
(contrived)f(but)g(minimal)g(staged)f(pr)o(ogram:)523
3781 y Fn(#)45 b(let)f(rec)g(h)h(n)g(z)f(=)h(if)g(n=0)f(then)g(z)1330
3873 y(else)g(.<\(fun)g(x)h(->)f(.\230\(h)g(\(n-1\))g(.<x+)g
(.\230z>.\)\))g(n>.;;)523 3964 y(val)g(h)h(:)g(int)f(->)h(int)f(code)g
(->)g(int)h(code)f(=)h(<fun>)523 4123 y Fp(If)21 b(we)g(erase)f(the)h
(annotations)i(\(to)e(get)g(the)g(\223unstaged\224)f(version)i(of)f
(this)h(function\))f(and)523 4215 y(apply)29 b(it)h(to)g
Fi(3)f Fp(and)g Fi(1)p Fp(,)g(we)h(get)f Fi(7)g Fp(as)g(the)h(answer)-6
b(.)29 b(If)g(we)h(apply)f(the)g(staged)g(function)523
4306 y(above)20 b(to)h Fi(3)g Fp(and)f Fi(.<1>.)p Fp(,)g(we)h(get)f
(the)h(following)h(term:)568 4466 y Fn(.<\(fun)44 b(x_1)g(->)h(\(fun)f
(x_2)g(->)g(\(fun)h(x_3)f(->)g(\(x_3)h(+)f(\(x_2)g(+)h(\(x_1)f(+)h
(1\)\)\)\))f(1\))568 4557 y(2\))g(3>.)523 4725 y Fp(Note)28
b(that)f(wher)o(eas)g(the)g(sour)o(ce)g(code)g(only)i(had)e
Fi(fun)49 b(x)h(->)f(...)27 b Fp(inside)h(brackets,)523
4825 y(this)22 b(code)e(fragment)h(was)f(generated)g(thr)o(ee)g(times,)
h(and)f(each)h(time)g(it)g(pr)o(oduced)e(a)i(dif-)523
4924 y(fer)o(ent)16 b Fi(fun)49 b(x_i)h(->)f(...)17 b
Fp(wher)o(e)g Fi(i)g Fp(is)g(a)g(dif)o(fer)o(ent)e(number)j(each)e
(time.)i(If)f(we)g(r)o(un)h(the)1943 5173 y(3)p eop
%%Page: 4 4
4 3 bop 523 448 a Fp(generated)20 b(code)i(above,)e(we)i(get)f
Fi(7)g Fp(as)h(the)f(answer)-6 b(.)21 b(W)-8 b(e)22 b(view)f(it)h(as)f
(a)g(highly)i(desirable)523 548 y(pr)o(operty)16 b(that)i(the)f(r)o
(esults)g(generated)f(by)h(staged)g(pr)o(ograms)g(ar)o(e)f(r)o(elated)f
(to)j(the)f(r)o(esults)523 648 y(generated)h(by)h(the)g(unstaged)g(pr)o
(ogram.)e(The)i(r)o(eader)e(can)i(verify)f(for)h(herself)f(that)h(if)g
(the)523 747 y Fi(x)p Fp(s)24 b(wer)o(e)g(not)h(r)o(enamed,)e(the)i
(answer)f(of)g(r)o(unning)i(the)f(stage)f(pr)o(ogram)g(would)h(be)f
(dif-)523 847 y(fer)o(ent.)f(Thus,)h(automatic)g(r)o(enaming)g(of)g
(bound)g(variables)f(is)i(not)f(so)h(much)f(a)g(featur)o(e,)523
946 y(rather)-6 b(,)20 b(it)h(is)g(the)g(absence)f(of)g(r)o(enaming)h
(that)g(seems)g(like)g(a)f(bug.)523 1194 y Fl(2)99 b(How)26
b(Do)f(W)-7 b(e)24 b(W)-7 b(rite)24 b(MSP)g(Programs?)523
1376 y Fp(Good)34 b(abstraction)e(mechanisms)i(can)f(help)g(the)g(pr)o
(ogrammer)f(write)h(mor)o(e)f(concise)523 1475 y(and)22
b(maintainable)h(pr)o(ograms.)f(But)g(if)g(these)h(abstraction)g
(mechanisms)g(degrade)e(per)o(-)523 1575 y(formance,)30
b(they)h(will)h(not)g(be)e(used.)h(Pr)o(ogram)f(generation)h(can)g
(help)g(to)g(r)o(educe)f(the)523 1674 y(r)o(untime)e(over)o(head)e(of)i
(sophisticated)f(abstraction)g(mechanisms.)h(The)g(main)f(goal)h(of)523
1774 y(MSP)19 b(is)i(to)f(make)g(it)g(possible)g(for)g(pr)o(ogrammers)f
(to)i(write)f(generic)f(pr)o(ograms)h(without)523 1874
y(having)h(to)g(pay)g(a)f(r)o(untime)h(penalty)g(for)g(this)g
(generality)-9 b(.)648 1973 y(MSP)22 b(admits)h(an)g(intuitively)h
(appealing)e(method)i(of)f(designing)h(and)f(implement-)523
2073 y(ing)e(generative)f(systems:)560 2217 y(1.)41 b(A)21
b(single-stage)f(pr)o(ogram)g(is)i(developed,)d(implemented,)i(and)f
(tested.)560 2312 y(2.)41 b(The)23 b(or)o(ganization)f(and)h(data-str)o
(uctur)o(es)e(of)h(the)h(pr)o(ogram)f(ar)o(e)g(studied)g(to)i(ensur)o
(e)664 2411 y(that)19 b(they)g(can)g(be)g(used)g(in)g(a)g(staged)f
(manner)-6 b(.)19 b(This)g(analysis)g(may)g(indicate)g(a)f(need)664
2511 y(for)j(\223factoring\224)e(some)j(parts)e(of)h(the)g(pr)o(ogram)f
(and)g(its)i(data)d(str)o(uctur)o(es.)i(This)g(step)664
2611 y(can)29 b(be)g(subtle,)f(and)h(can)g(be)f(a)h(critical)f(step)h
(towar)o(d)g(ef)o(fective)e(multi-stage)i(pr)o(o-)664
2710 y(gramming.)d(Fortunately)-9 b(,)25 b(it)g(has)g(been)g(thor)o
(oughly)i(investigated)e(in)g(the)h(context)664 2810
y(of)21 b(partial)f(evaluation)g(wher)o(e)g(it)h(is)h(known)g(as)e
Fk(binding-time)g(engineering)i Fp([5)o(].)560 2905 y(3.)41
b(Staging)26 b(annotations)i(ar)o(e)c(intr)o(oduced)i(to)g(specify)g
(explicitly)g(the)h(evaluation)f(or)o(-)664 3005 y(der)d(of)h(the)f
(various)h(computations)h(of)e(the)h(pr)o(ogram.)e(The)i(staged)f(pr)o
(ogram)g(may)664 3104 y(then)e(be)g(tested)f(to)h(ensur)o(e)f(that)h
(it)g(achieves)f(the)h(desir)o(ed)f(performance.)648
3252 y(The)e(method)i(described)d(above,)h(called)g Fk(multi-stage)g
(pr)o(ogramming)e(with)i(explicit)g(an-)523 3352 y(notations)i([19)o(])
p Fp(,)g(can)h(be)f(summarized)g(by)h(the)g(slogan:)p
667 3436 2594 4 v 667 3569 4 134 v 696 3521 a(A)f(Staged)g(Pr)o(ogram)g
(=)h(A)f(Conventional)i(Pr)o(ogram)e(+)h(Staging)g(Annotations)p
3257 3569 V 667 3572 2594 4 v 523 3690 a(The)i(conciseness)h(of)f
(annotations)h(means)f(that)g(pr)o(ogram)f(generators)h(derived)f(in)h
(this)523 3790 y(way)f(ar)o(e)f(often)h(simple)h(variations)f(on)g
(conventional)h(pr)o(ograms.)f(W)-8 b(e)22 b(expect)f(that,)h(for)523
3889 y(a)g(wide)g(range)f(of)h(applications,)g(this)h(appr)o(oach)d
(will)j(be)f(mor)o(e)g(ef)o(fective)e(than)i(writing)523
3989 y(generators)h(in)i(a)e(general-purpose)g(pr)o(ogramming)h
(language)f(and)g(fr)o(om)h(scratch.)f(W)-8 b(e)523 4088
y(also)26 b(expect)e(that)h(power)h(of)f(the)g(static)g(type)g(systems)
i(available)d(for)h(MSP)f(languages)523 4188 y(will)e(r)o(educe)d
(testing)i(costs.)523 4419 y Fj(2.1)82 b(A)20 b(classic)f(example)523
4559 y Fp(A)28 b(common)j(sour)o(ce)d(of)h(performance)f(over)o(head)f
(in)j(generic)e(pr)o(ograms)h(is)g(the)g(pr)o(es-)523
4650 y(ence)e(of)g(parameters)e(that)i(do)g(not)g(change)g(very)g
(often,)g(but)g(nevertheless)f(cause)h(our)523 4742 y(pr)o(ograms)f(r)o
(epeatedly)e(perform)h(the)i(work)f(associated)f(with)i(these)f
(inputs.)h(T)-8 b(o)27 b(illus-)523 4833 y(trate)j(this,)h(we)g
(consider)g(the)g(following)h(implementation)g(of)f(a)g(simple)g
(function)g(in)523 4924 y(MetaOCaml:)20 b([5)o(])1943
5173 y(4)p eop
%%Page: 5 5
5 4 bop 523 448 a Fn(let)44 b(rec)h(power)f(\(n,)g(x\))h(=)658
540 y(match)f(n)g(with)747 631 y(0)h(->)f(1)658 722 y(|)g(n)h(->)f(x)h
(*)g(\(power)f(\(n-1,)f(x\)\);;)523 872 y Fp(This)29
b(function)g(is)g(generic)g(in)g(that)f(it)h(can)f(be)h(used)f(to)h
(compute)g Fi(x)f Fp(raised)g(to)h Fk(any)f Fp(ex-)523
963 y(ponent)c Fi(n)p Fp(.)g(While)g(it)g(is)g(convenient)g(to)h(use)e
(generic)h(functions)h(like)f Fi(power)p Fp(,)e(we)i(often)523
1054 y(\002nd)e(that)g(we)f(have)g(to)i(pay)e(a)g(price)g(for)g(their)h
(generality)-9 b(.)21 b(Developing)i(a)e(good)h(under)o(-)523
1146 y(standing)28 b(of)g(the)g(sour)o(ce)f(of)g(this)i(performance)e
(penalty)g(is)h(important,)g(because)f(it)h(is)523 1237
y(exactly)c(what)h(MSP)f(will)i(help)f(us)g(eliminate.)g(For)g
(example,)f(if)g(we)h(need)f(to)i(compute)523 1328 y(the)18
b(squar)o(e)f(\(the)h(second)g(power\))g(often,)f(it)h(is)h(convenient)
f(to)h(de\002ne)e(a)h(special)f(function)523 1420 y(such)k(as:)523
1569 y Fn(let)44 b(power2)g(\(x\))h(=)f(power)g(\(2,x\);;)523
1719 y Fp(In)21 b(a)f(functional)i(language,)e(we)g(can)h(also)g(write)
g(it)g(as)f(follows:)523 1868 y Fn(let)44 b(power2)g(=)h(fun)f(x)h(->)f
(power)g(\(2,x\);;)523 2026 y Fp(Her)o(e,)26 b(we)h(have)g(taken)g
(away)g(the)h(formal)f(parameter)f Fi(x)h Fp(fr)o(om)g(the)g(left-hand)
g(side)g(of)523 2126 y(the)f(equality)h Fi(=)f Fp(and)g(r)o(eplaced)e
(it)i(by)g(the)h(equivalent)f Fi(fun)49 b(x)h(->)26 b
Fp(on)h(the)f(right-hand)523 2226 y(side.)648 2317 y(T)-8
b(o)21 b(use)g(the)g(function)g Fi(power2)p Fp(,)f(all)g(we)h(have)f
(to)h(do)g(is)g(to)g(apply)g(it)g(as)f(follows:)523 2466
y Fn(let)44 b(answer)g(=)h(power2)f(\(3\);;)523 2616
y Fp(The)31 b(r)o(esult)g(of)g(this)h(computation)g(is)f(simply)h(the)f
(integer)g Fi(9)p Fp(.)g(But)g(notice)g(that)h(every)523
2707 y(time)19 b(we)f(apply)h Fi(power2)e Fp(to)i(some)g(value)f
Fi(x)g Fp(it)h(calls)f(the)h Fi(power)f Fp(function)h(with)g(param-)523
2799 y(eters)j Fi(\(2,x\))p Fp(.)g(And)g(even)g(though)i(the)f(\002rst)
f(ar)o(gument)g(will)i(always)e(be)g Fi(2)p Fp(,)g(evaluating)523
2890 y Fi(power)49 b(\(2,x\))24 b Fp(will)h(always)f(involve)i(calling)
e(the)h(function)h(r)o(ecursively)d(two)j(times.)523
2981 y(This)g(is)g(an)f(undesirable)g(over)o(head,)f(because)g(we)i
Fk(know)f Fp(that)g(the)h(r)o(esult)f(can)g(be)g(mor)o(e)523
3073 y(ef)o(\002ciently)e(computed)g(by)h(just)g(multiplying)h
Fi(x)e Fp(by)g(itself.)g(Using)h(only)g(unfolding)g(and)523
3164 y(the)f(de\002nition)i(of)e Fi(power)p Fp(,)f(we)i(know)g(that)f
(the)h(answer)f(can)g(be)g(computed)g(mor)o(e)g(ef)o(\002-)523
3255 y(ciently)e(by:)523 3405 y Fn(let)44 b(power2)g(x)h(=)g(1*x*x;;)
523 3563 y Fp(W)-8 b(e)23 b(also)g(do)g(not)h(want)f(to)g(write)g(this)
g(by)g(hand,)g(as)f(ther)o(e)g(may)h(be)g(many)g(speci\002c)g(con-)523
3662 y(stant)j(powers)f(that)h(we)f(want)h(to)g(use)f(\(other)g(than)h
(two\).)f(So)h(the)f(question)i(is,)f(can)f(we)523 3762
y Fk(automatically)19 b Fp(build)i(such)g(a)f(pr)o(ogram?)648
3853 y(In)i(an)g(MSP)f(language)g(such)i(as)e(MetaOCaml,)g(the)h
(answer)g(is)g(yes.)g(All)g(we)g(need)g(to)523 3944 y(do)f(is)g(to)g
Fk(stage)f Fp(the)h(power)g(function)h(by)f(annotating)g(it)g(as)f
(follows:)523 4094 y Fn(let)44 b(rec)h(power)f(\(n,)g(x\))h(=)658
4185 y(match)f(n)g(with)747 4277 y(0)h(->)f(.<1>.)658
4368 y(|)g(n)h(->)f(.<.\230x)g(*)h(.\230\(power)e(\(n-1,)h(x\)\)>.;;)
523 4526 y Fp(This)31 b(function)h(still)f(takes)g(two)g(ar)o(guments,)
f(but)h(now)g(the)g(second)g(ar)o(gument)f(is)h(no)523
4625 y(longer)26 b(an)f(integer)-6 b(,)24 b(but)h(rather)-6
b(,)24 b(a)h Fk(code)g(of)g(type)f(integer)p Fp(.)h(The)g(r)o(esult)f
(of)h(the)h(function)g(is)523 4725 y(also)19 b(changed.)g(Instead)g(of)
g(r)o(eturning)g(an)g(integer)-6 b(,)18 b(this)i(function)g(will)g(r)o
(eturn)f(a)f(code)h(of)523 4825 y(type)i(integer)-6 b(.)20
b(T)-8 b(o)22 b(match)e(this)i(r)o(eturn)e(type,)h(we)f(insert)h
(Brackets)f(ar)o(ound)g Fi(1)h Fp(on)g(the)g(sec-)523
4924 y(ond)26 b(line.)h(By)f(inserting)h(Brackets)e(ar)o(ound)g(the)h
(multiplication)h(expr)o(ession,)f(we)g(now)1943 5173
y(5)p eop
%%Page: 6 6
6 5 bop 523 448 a Fp(r)o(eturn)17 b(a)h(code)g(of)g(integer)g(instead)f
(just)i(an)f(integer)-6 b(.)18 b(The)g(Escape)f(ar)o(ound)g(the)h(r)o
(ecursive)523 548 y(call)i(to)i(power)e(means)h(that)g(it)g(is)g
(performed)f(immediately)-9 b(.)648 659 y(Note)23 b(that)f(added)g
(staging)h(constr)o(ucts)h(can)f(be)f(viewed)g(as)h(simply)h
(\223annotations\224)523 759 y(on)d(the)f(original)h(pr)o(ogram,)e(and)
h(that)g(they)g(ar)o(e)f(fairly)h(unobtr)o(usive.)h(Also,)f(we)g(ar)o
(e)f(able)523 858 y(to)27 b(type)g(check)g(the)g(code)g(both)h(outside)
f(and)f(inside)i(the)f(Brackets)f(in)h(essentially)h(the)523
958 y(same)23 b(way)h(that)f(we)h(did)f(befor)o(e.)f(If)h(we)g(wer)o(e)
g(using)h(strings)h(instead)e(of)h(Brackets,)e(we)523
1057 y(would)f(have)g(to)g(sacri\002ce)f(static)g(\(early\))g(type)h
(checking)g(of)g(delayed)e(computations.)648 1160 y(After)g(annotating)
i Fi(power)p Fp(,)e(we)h(have)g(to)h(annotate)f(the)g(uses)h(of)f
Fi(power)p Fp(.)f(The)h(decla-)523 1252 y(ration)h(of)g
Fi(power2)e Fp(is)i(annotated)g(as)f(follows:)523 1455
y Fn(let)44 b(power2)g(=)h(.!)f(.<fun)g(x)h(->)f(.\230\(power)g
(\(2,.<x>.\)\)>.;;)523 1655 y Fp(The)21 b(outermost)h(annotation)f(is)h
(Run)f(\()p Fi(.!)p Fp(\).)f(This)h(will)h(compile)f(\(and)f(if)h
(necessary)-9 b(,)20 b(exe-)523 1755 y(cute\))g(its)g(ar)o(gument.)g
(The)g(ar)o(gument)g(itself)g(is)h(essentially)g(the)f(same)g(as)g
(what)h(we)f(used)523 1855 y(to)31 b(de\002ne)g Fi(power2)f
Fp(befor)o(e,)f(except)h(that)h(we)g(have)f(also)h(added)f(some)h
(annotations.)523 1954 y(The)19 b(annotations)i(say)e(that)g(we)g(wish)
i(to)e(constr)o(uct)i(the)e(code)g(for)g(a)g(function)h(that)f(takes)
523 2054 y(one)26 b(ar)o(gument)g(\()p Fi(fun)48 b(x)i(->)p
Fp(\).)25 b(W)-8 b(e)26 b(do)g(not)g(actually)f(spell)h(out)h(what)f
(the)g(function)g(it-)523 2153 y(self)e(should)i(do.)e(Instead,)g(we)g
(use)h(the)f(Escape)g(constr)o(uct)h(\()p Fi(.\230)p
Fp(\))f(to)g(make)h(a)f(call)g(to)h(the)523 2253 y(staged)c(power)h
(function)g Fi(power)p Fp(.)f(W)-8 b(e)21 b(pass)h(two)g(ar)o(guments.)
f(The)h(\002rst)g(one)g(is)g(a)f(r)o(egu-)523 2353 y(lar)d(integer)h
(ar)o(gument,)f Fi(2)p Fp(.)h(The)f(second)h(ar)o(gument)g(is)g(a)f
(delayed)g(integer)-6 b(.)18 b(The)h(delayed)523 2452
y(integer)26 b(is)h(the)f(term)h Fi(.<x>.)p Fp(.)e(Because)g(the)h
(call)g(to)h(the)f Fi(power)g Fp(function)h(is)f(Escaped,)523
2552 y(it)c Fk(escapes)g Fp(the)f(delaying)h(ef)o(fect)d(of)j(the)f
(surr)o(ounding)h(Brackets,)e(and)i(is)f(performed)g(im-)523
2652 y(mediately)-9 b(.)18 b(This)i(means)f(that)g(the)g(\002rst)g
(thing)h(that)f(gets)g(done)h(when)f(we)g(enter)g(\(or)g(r)o(un\))523
2751 y(the)g(expr)o(ession)g(above)f(is)h(this)h(call)f(to)g
Fi(power)p Fp(.)f(It)h(r)o(eturns)f(a)h(delayed)e(value)i(containing)
523 2851 y(exactly)29 b Fi(.<1*x*x>.)p Fp(.)g(The)h(Escape)f(then)h
(inserts)h(this)g(into)g(the)f(context)g(of)g(the)h(sur)o(-)523
2950 y(r)o(ounding)d(Brackets,)e(and)g(we)i(have)e Fi(.<)50
b(fun)f(x)h(->)f(1*x*x)g(>.)p Fp(.)27 b(Now)g(evaluating)523
3050 y(the)21 b(ar)o(gument)g(to)h Fi(.!)f Fp(is)g(complete.)g(It)h(is)
f(then)h(passed)e(to)i(the)f(compiler)-6 b(.)21 b(The)h(compiler)523
3150 y(r)o(eturns)d(a)g(value)g(and)f(binds)i(it)g(to)g
Fi(power2)p Fp(.)e(This)h(value)g(behaves)g(exactly)g(as)g(if)g(we)g
(had)523 3249 y(de\002ned)h(it)h(\223by)g(hand\224)f(to)h(be)g
Fi(fun)49 b(x)g(->)h(1*x*x)p Fp(.)20 b(The)g(staged)h
Fi(power2)e Fp(will)j(behave)523 3349 y(exactly)e(like)h(the)g
(unstaged)g Fi(power2)p Fp(,)e(but)i(it)g(will)g(r)o(un)h(faster)-6
b(.)523 3672 y Fl(3)99 b(Implementing)24 b(DSLs)h(Using)g(MSP)523
3928 y Fp(An)32 b(important)h(application)f(for)g(MSP)g(is)h(the)f
(implementation)i(of)e(domain-speci\002c)523 4028 y(languages)16
b(\(DSLs\).)e(Languages)h(can)h(be)f(implemented)h(in)h(a)e(variety)g
(of)h(dif)o(fer)o(ent)d(ways.)523 4127 y(For)k(example,)f(a)g(language)
g(can)h(be)f(implemented)h(by)f(an)h(interpr)o(eter)e(or)i(by)g(a)f
(compiler)-6 b(.)523 4227 y(Compilers)29 b(ar)o(e)e(often)i(or)o(ders)e
(of)i(magnitude)f(faster)g(than)g(interpr)o(eters,)g(but)g(r)o(equir)o
(e)523 4327 y(signi\002cant)35 b(expertise)e(and)g(take)h(or)o(ders)f
(of)g(magnitude)h(mor)o(e)g(time)g(to)g(implement)523
4426 y(than)24 b(interpr)o(eters.)e(Using)i(the)f(strategy)g(outlined)h
(above)f(for)g(using)i(MSP)d(languages,)523 4526 y(if)c(we)g(start)g
(by)h(\002rst)f(writing)i(an)e(interpr)o(eter)f(for)h(a)g(language)g
(and)g(then)g(stage)g(it,)h(we)f(get)523 4625 y Fk(a)29
b(staged)e(interpr)o(eter)p Fp(.)i(Such)g(staged)f(interpr)o(eters)f
(ar)o(e)h(often)h(almost)g(as)f(simple)h(as)g(the)523
4725 y(interpr)o(eter)22 b(we)h(started)g(with,)h(but)f(can)g(have)g
(performance)g(comparable)f(to)i(that)f(of)g(a)523 4825
y(compiler)-6 b(.)25 b(The)h(r)o(eason)f(for)g(this)h(is)g(that)g(a)f
(staged)g(interpr)o(eter)f(becomes)i(ef)o(fectively)d(a)523
4924 y Fk(translator)k Fp(fr)o(om)f(the)h(DSL)g(to)g(the)g(host)h
(language)f(\(in)g(this)g(case)g(MetaOCaml\).)e(Then,)1943
5173 y(6)p eop
%%Page: 7 7
7 6 bop 523 448 a Fp(by)20 b(using)g(MetaOCaml's)f(Run)i(constr)o(uct,)
f(the)g(composition)h(is)f(in)h(fact)d(a)i(function)g(that)523
548 y(takes)g(DSL)h(pr)o(ograms)f(and)g(pr)o(oduces)g(machine)h(code)
2316 518 y Fg(1)2349 548 y Fp(.)648 640 y(T)-8 b(o)19
b(illustrate)f(this)i(appr)o(oach,)c(we)j(consider)g(the)f
(implementation)i(of)f(a)f(simple)h(pr)o(o-)523 731 y(gramming)g
(language)f(\(let's)g(call)g(it)g Fi(lint)p Fp(\))f(with)i(support)g
(for)f(integer)g(arithmetic,)g(con-)523 833 y(ditionals,)25
b(and)e(r)o(ecursive)g(functions)1756 803 y Fg(2)1790
833 y Fp(.)h(The)g(syntax)h(of)f(expr)o(essions)g(in)g(this)h(language)
523 924 y(can)20 b(be)h(r)o(epr)o(esented)e(in)i(OCaml)g(using)g(the)g
(following)h(data)e(type:)523 1086 y Fn(type)44 b(exp)h(=)f(Int)h(of)f
(int)g(|)h(Var)f(of)h(string)f(|)g(App)h(of)f(string)g(*)h(exp)927
1177 y(|)f(Add)h(of)f(exp)g(*)h(exp)f(|)h(Sub)f(of)h(exp)f(*)h(exp)927
1268 y(|)f(Mul)h(of)f(exp)g(*)h(exp)f(|)h(Div)f(of)h(exp)f(*)h(exp)927
1360 y(|)f(Ifz)h(of)f(exp)g(*)h(exp)f(*)h(exp)523 1542
y(type)f(def)h(=)f(Declaration)f(of)i(string)e(*)i(string)f(*)h(exp)523
1634 y(type)f(prog)g(=)h(Program)f(of)g(def)g(list)h(*)f(exp)523
1794 y Fp(Using)22 b(the)f(above)g(data)g(types,)g(a)g(small)h(pr)o
(ogram)e(that)i(de\002nes)f(the)h(factorial)e(function)523
1885 y(and)g(then)i(applies)e(it)h(to)g(10)f(can)g(be)h(concisely)g(r)o
(epr)o(esented)e(as)h(follows:)523 2046 y Fn(Program)44
b(\([Declaration)971 2138 y(\("fact","x",)f(Ifz\(Var)h("x",)1465
2229 y(Int)g(1,)1465 2320 y(Mul\(Var"x",)1644 2412 y(\(App)g(\("fact",)
f(Sub\(Var)h("x",Int)g(1\)\)\)\)\)\))927 2503 y(],)927
2594 y(App)g(\("fact",)f(Int)i(10\)\))523 2763 y Fp(OCaml)25
b(lex)g(and)f(yacc)h(can)g(be)f(used)h(to)g(build)g(parsers)f(that)h
(take)g(textual)f(r)o(epr)o(esenta-)523 2863 y(tions)e(of)g(such)g(pr)o
(ograms)e(and)h(pr)o(oduce)g(abstract)f(syntax)h(tr)o(ees)g(such)h(as)f
(the)g(above.)g(In)523 2962 y(the)g(r)o(est)f(of)h(this)h(section,)f
(we)g(focus)g(on)h(what)f(happens)g(after)f(such)h(an)g(abstract)f
(syntax)523 3062 y(tr)o(ee)g(has)g(been)h(generated.)648
3154 y(T)-8 b(o)28 b(associate)f(both)i(variable)d(and)h(function)i
(names)f(with)g(their)g(values,)f(an)h(inter)o(-)523
3246 y(pr)o(eter)f(for)i(this)g(language)f(will)h(need)f(a)g(notion)j
(of)d(an)g(envir)o(onment.)h(Such)g(an)f(envi-)523 3337
y(r)o(onment)20 b(can)g(be)f(conveniently)i(implemented)f(as)g(a)f
(function)i(fr)o(om)e(names)h(to)h(values.)523 3428 y(If)k(we)h(look)h
(up)f(a)f(variable)f(and)i(it)g(is)g(not)g(an)g(envir)o(onment,)g(we)g
(will)g(raise)g(an)f(excep-)523 3519 y(tion)e(\(let's)g(call)f(it)h
Fi(Yikes)p Fp(\).)e(If)h(we)h(want)f(to)h(extend)f(the)h(envir)o
(onment)g(\(which)g(is)g(just)g(a)523 3611 y(function\))j(with)h(an)e
(association)h(fr)o(om)g(the)g(name)f Fi(x)h Fp(to)g(a)f(value)g
Fi(v)p Fp(,)g(we)h(simply)h(r)o(eturn)523 3702 y(a)g(new)h(envir)o
(onment)h(\(a)e(function\))h(which)h(\002rst)f(tests)g(to)g(see)f(if)h
(it's)g(ar)o(gument)g(is)g(the)523 3793 y(same)21 b(as)f
Fi(x)p Fp(.)h(If)f(so,)h(it)g(r)o(eturns)g Fi(v)p Fp(.)f(Otherwise,)h
(it)g(looks)i(up)d(its)i(ar)o(gument)e(in)h(the)g(original)523
3885 y(envir)o(onment.)g(All)g(we)g(need)f(to)h(implement)h(such)f
(envir)o(onments)g(is)g(the)g(following:)523 4046 y Fn(exception)43
b(Yikes)523 4137 y(let)h(env0)h(=)f(fun)h(x)f(->)h(raise)f(Yikes)178
b(let)44 b(fenv0)g(=)h(env0)523 4229 y(let)f(ext)h(env)f(x)h(v)f(=)h
(fun)f(y)h(->)f(if)h(x=y)f(then)g(v)h(else)f(env)h(y)523
4389 y Fp(Given)36 b(an)g(envir)o(onment)g(binding)g(variable)f(names)h
(to)g(their)g(r)o(untime)g(values)f(and)523 4480 y(function)30
b(names)e(to)h(values)g(\(let's)f(call)h(them)g Fi(env)f
Fp(and)g Fi(fenv)p Fp(,)g(r)o(espectively\),)f(an)i(in-)523
4572 y(terpr)o(eter)19 b(for)i(an)f(expr)o(ession)h Fi(e)f
Fp(can)h(be)f(de\002ned)g(as)h(follows:)p 523 4652 473
4 v 558 4708 a Ff(1)606 4740 y Fo(If)k(we)h(ar)o(e)f(using)f(the)i
(MetaOCaml)g(native)g(code)f(compiler)-6 b(.)24 b(If)h(we)h(ar)o(e)f
(using)g(the)h(bytecode)606 4831 y(compiler)-6 b(,)18
b(of)g(course,)f(the)j(composition)e(pr)o(oduces)f(bytecode.)558
4893 y Ff(2)606 4924 y Fo(The)i(complete)f(code)g(for)g(the)h
Fn(lint)f Fo(example)g(is)g(available)i(online)e([8)q(].)1943
5173 y Fp(7)p eop
%%Page: 8 8
8 7 bop 523 448 a Fn(let)44 b(rec)h(eval1)f(e)g(env)h(fenv)f(=)523
540 y(match)g(e)h(with)613 631 y(Int)f(i)h(->)f(i)523
722 y(|)h(Var)f(s)h(->)f(env)h(s)523 814 y(|)g(App)f(\(s,e2\))g(->)g
(\(fenv)g(s\)\(eval1)g(e2)g(env)h(fenv\))523 905 y(|)g(Add)f(\(e1,e2\))
g(->)g(\(eval1)g(e1)g(env)h(fenv\)+\(eval1)e(e2)h(env)g(fenv\))523
996 y(|)h(Sub)f(\(e1,e2\))g(->)g(\(eval1)g(e1)g(env)h(fenv\)-\(eval1)e
(e2)h(env)g(fenv\))523 1088 y(|)h(Mul)f(\(e1,e2\))g(->)g(\(eval1)g(e1)g
(env)h(fenv\)*\(eval1)e(e2)h(env)g(fenv\))523 1179 y(|)h(Div)f
(\(e1,e2\))g(->)g(\(eval1)g(e1)g(env)h(fenv\)/\(eval1)e(e2)h(env)g
(fenv\))523 1270 y(|)h(Ifz)f(\(e1,e2,e3\))f(->)i(if)f(\(eval1)g(e1)g
(env)h(fenv\)=0)1465 1362 y(then)f(\(eval1)f(e2)i(env)f(fenv\))1465
1453 y(else)g(\(eval1)f(e3)i(env)f(fenv\))523 1617 y
Fp(This)24 b(interpr)o(eter)d(can)i(now)h(be)f(used)g(to)g(de\002ne)g
(the)g(interpr)o(eter)f(for)h(declarations)f(and)523
1708 y(pr)o(ograms)e(as)h(follows:)523 1874 y Fn(let)44
b(rec)h(peval1)f(p)g(env)h(fenv=)702 1965 y(match)f(p)h(with)747
2056 y(Program)f(\([],e\))g(->)g(eval1)g(e)h(env)f(fenv)702
2148 y(|Program)g(\(Declaration)f(\(s1,s2,e1\)::tl,e\))f(->)882
2239 y(let)i(rec)g(f)h(x)g(=)f(eval1)g(e1)h(\(ext)f(env)g(s2)h(x\))f
(\(ext)g(fenv)h(s1)f(f\))882 2330 y(in)g(peval1)g(\(Program\(tl,e\)\))e
(env)j(\(ext)f(fenv)g(s1)g(f\))523 2503 y Fp(In)34 b(this)g(function,)f
(when)h(the)g(list)g(of)f(declarations)f(is)i(empty)g(\()p
Fi([])p Fp(\),)d(we)j(simply)g(use)523 2602 y Fi(eval1)26
b Fp(to)i(evaluate)e(the)i(body)f(of)g(the)h(pr)o(ogram.)e(Otherwise,)i
(we)f(r)o(ecursively)g(inter)o(-)523 2702 y(pr)o(et)22
b(the)g(list)i(of)e(declarations.)g(Note)h(that)f(we)h(also)g(use)g
Fi(eval1)e Fp(to)i(interpr)o(et)f(the)h(body)523 2801
y(of)f(function)g(declarations.)f(It)h(is)g(also)g(instr)o(uctive)g(to)
g(note)g(the)g(thr)o(ee)f(places)g(wher)o(e)g(we)523
2901 y(use)h(the)g(envir)o(onment)g(extension)h(function)f
Fi(ext)g Fp(on)g(both)h(variable)d(and)i(function)g(en-)523
3001 y(vir)o(onments.)648 3102 y(The)k(above)g(interpr)o(eter)f(is)h(a)
g(complete)h(and)f(concise)g(speci\002cation)h(of)f(what)h(pr)o(o-)523
3202 y(grams)d(in)h(this)f(language)g(should)h(pr)o(oduce)e(when)i
(they)f(ar)o(e)f(executed.)f(Additionally)-9 b(,)523
3302 y(this)26 b(style)f(of)h(writing)g(interpr)o(eters)e(follows)i
(quite)g(closely)g(what)f(is)g(called)g(the)g(deno-)523
3401 y(tational)e(style)g(of)g(specifying)g(semantics,)g(for)g(which)g
(ther)o(e)f(is)i(vast)e(literatur)o(e)g(on)h(how)523
3501 y(to)k(specify)g(a)f(wide)h(range)f(of)h(pr)o(ogramming)g
(languages.)f(It)h(is)g(r)o(easonable)f(to)h(expect)523
3600 y(that)c(a)g(softwar)o(e)g(engineer)g(can)g(develop)g(such)h
(implementations)h(in)e(a)g(short)h(amount)523 3700 y(of)d(time.)648
3802 y(The)e(question)h(then)f(is)h(how)f(the)h(performance)d(of)i
(such)h(an)f(interpr)o(eter)e(far)o(es.)g(If)i(we)523
3901 y(evaluate)25 b(the)i(factorial)e(example)h(given)h(above,)f(we)g
(will)h(\002nd)g(that)g(it)f(r)o(uns)i(about)e(20)523
4001 y(times)d(slower)g(than)g(if)f(we)g(had)g(written)h(this)h
(example)d(dir)o(ectly)h(in)h(OCaml.)f(The)h(main)523
4101 y(r)o(eason)29 b(for)g(this)h(is)g(that)f(the)h(interpr)o(eter)e
(r)o(epeatedly)g(traverses)g(the)i(abstract)e(syntax)523
4200 y(tr)o(ee)19 b(during)h(evaluation.)g(Additionally)-9
b(,)20 b(envir)o(onment)h(lookups)g(in)g(our)f(implementa-)523
4300 y(tion)i(ar)o(e)d(not)i(constant-time.)648 4393
y(MSP)28 b(allows)i(us)g(to)g(keep)f(the)h(conciseness)g(and)f(clarity)
h(of)f(the)h(implementation)523 4485 y(given)19 b(above)g(and)g(also)g
(eliminate)g(the)h(performance)e(over)o(head)g(that)h(traditionally)g
(we)523 4576 y(would)34 b(have)e(had)h(to)g(pay)g(for)g(using)h(such)f
(an)g(implementation.)h(The)f(over)o(head)f(is)523 4667
y(avoided)20 b(by)h(staging)g(the)g(above)f(function)i(as)e(follows:)
523 4833 y Fn(let)44 b(rec)h(eval2)f(e)g(env)h(fenv)f(=)523
4924 y(match)g(e)h(with)1943 5173 y Fp(8)p eop
%%Page: 9 9
9 8 bop 613 448 a Fn(Int)44 b(i)h(->)f(.<i>.)523 540
y(|)h(Var)f(s)h(->)f(env)h(s)523 631 y(|)g(App)f(\(s,e2\))g(->)g
(.<.\230\(fenv)g(s\).\230\(eval2)f(e2)h(env)h(fenv\)>.)e(...)523
722 y(|)i(Div)f(\(e1,e2\)->)f(.<.\230\(eval2)g(e1)i(env)f(fenv\)/)g
(.\230\(eval2)g(e2)g(env)g(fenv\)>.)523 814 y(|)h(Ifz)f(\(e1,e2,e3\))f
(->)i(.<if)f(.\230\(eval2)f(e1)i(env)f(fenv\)=0)1554
905 y(then)g(.\230\(eval2)g(e2)g(env)h(fenv\))1554 996
y(else)f(.\230\(eval2)g(e3)g(env)h(fenv\)>.)523 1179
y(let)f(rec)h(peval2)f(p)g(env)h(fenv=)702 1270 y(match)f(p)h(with)747
1362 y(Program)f(\([],e\))g(->)g(eval2)g(e)h(env)f(fenv)702
1453 y(|Program)g(\(Declaration)f(\(s1,s2,e1\)::tl,e\))f(->)747
1544 y(.<let)i(rec)h(f)f(x)h(=)g(.\230\(eval2)e(e1)h(\(ext)h(env)f(s2)g
(.<x>.\))2002 1636 y(\(ext)h(fenv)f(s1)g(.<f>.\)\))837
1727 y(in)g(.\230\(peval2)g(\(Program\(tl,e\)\))e(env)i(\(ext)g(fenv)h
(s1)f(.<f>.\)\)>.)523 1886 y Fp(If)24 b(we)h(apply)f
Fi(peval2)f Fp(to)i(the)g(abstract)e(syntax)i(tr)o(ee)e(of)i(the)g
(factorial)e(example)h(\(given)523 1977 y(above\))c(and)h(the)g(empty)h
(envir)o(onments)g Fi(env0)e Fp(and)h Fi(fenv0)p Fp(,)f(we)h(get)g
(back)g(the)g(follow-)523 2068 y(ing)g(code)g(fragment:)523
2228 y Fn(.<let)44 b(rec)g(f)h(=)g(fun)f(x)h(->)f(if)h(\(x)f(=)h(0\))f
(then)g(1)h(else)f(\(x)h(*)f(\(f)h(\(x)f(-)h(1\)\)\))613
2319 y(in)f(\(f)h(10\)>.)523 2487 y Fp(This)33 b(is)h(exactly)e(the)h
(same)g(code)f(that)h(we)g(would)g(have)f(written)i(by)f(hand)f(for)h
(that)523 2586 y(speci\002c)19 b(pr)o(ogram.)f(Running)i(this)g(pr)o
(ogram)e(has)h(exactly)f(the)h(same)g(performance)f(as)g(if)523
2686 y(we)j(had)f(written)h(the)g(pr)o(ogram)f(dir)o(ectly)g(in)h
(OCaml.)648 2786 y(Note)f(that)g(the)g(staged)f(interpr)o(eter)g(is)h
(a)g(function)g(that)g(takes)g(abstract)f(syntax)h(tr)o(ees)523
2885 y(and)f(pr)o(oduces)f(MetaOCaml)g(pr)o(ograms.)h(This)h(gives)f
(rise)g(to)h(a)f(simple)g(but)h(often)f(over)o(-)523
2985 y(looked)i(fact)f([16)o(,17)o(]:)p 1307 3080 1315
4 v 1307 3213 4 134 v 1335 3165 a(A)g(staged)g(interpr)o(eter)g(is)h(a)
f(translator)p 2618 3213 V 1307 3216 1315 4 v 648 3353
a(It)26 b(is)h(important)g(to)g(keep)f(in)h(mind)g(that)g(the)f(above)g
(example)g(is)h(quite)g(simplistic,)523 3453 y(and)i(that)g(ther)o(e)g
(ar)o(e)f(a)h(lot)h(of)f(inter)o(esting)h(technical)f(issues)h(that)g
(arise)e(when)j(we)e(try)523 3552 y(to)g(apply)g(MSP)f(to)i(r)o
(ealistic)e(pr)o(ogramming)h(languages.)g(Characterizing)f(what)h(MSP)
523 3652 y(cannot)21 b(do)f(is)h(dif)o(\002cult,)f(because)f(of)i(the)f
(need)g(for)g(technical)h(expr)o(essivity)e(ar)o(guments.)523
3752 y(W)-8 b(e)20 b(take)g(the)g(mor)o(e)g(practical)e(appr)o(oach)h
(of)h(explaining)g(what)g(MSP)g(can)f(do,)h(and)g(hope)523
3851 y(that)h(this)g(gives)g(the)g(r)o(eader)e(a)h(better)g(idea)g(of)h
(the)g(scope)f(of)h(this)h(technology)-9 b(.)648 3943
y(Returning)32 b(to)g(our)f(example)f(language,)h(a)g(generally)g
(desirable)f(featur)o(e)g(of)h(pr)o(o-)523 4034 y(gramming)23
b(languages)g(is)g(err)o(or)e(handling.)i(For)g(example,)e(the)i
(original)g(implementa-)523 4126 y(tion)i(of)f(the)f(interpr)o(eter)g
(uses)h(the)g(division)h(operation.)f(Because)e(the)i(division)h
(opera-)523 4217 y(tion)k(can)e(raise)g(a)g(divide-by-zer)o(o)e
(exception,)j(if)f(the)h(interpr)o(eter)e(is)i(part)f(of)h(a)f(bigger)
523 4308 y(system,)f(we)f(might)h(want)f(to)h(have)f(\002ner)g(contr)o
(ol)h(over)f(err)o(or)f(handling.)h(In)h(this)g(case,)523
4400 y(we)20 b(would)h(modify)g(our)f(original)h(interpr)o(eter)e(to)i
(perform)f(a)g(check)g(befor)o(e)f(a)h(division,)523
4491 y(and)e(r)o(eturn)f(a)h(special)f(value)h Fi(None)f
Fp(if)h(the)g(division)h(could)g(not)f(be)g(performed.)f(Regular)523
4582 y(values)k(that)h(used)f(to)h(be)f(simply)i Fi(v)e
Fp(will)h(now)h(be)e(r)o(epr)o(esented)e(by)j Fi(Some)49
b(v)p Fp(.)21 b(Note)h(also)523 4674 y(that)j(such)h(a)f(value)f(would)
i(have)f(to)g(be)g(pr)o(opagated)e(and)i(dealt)g(with)g(everywher)o(e)f
(in)523 4765 y(the)d(interpr)o(eter:)523 4924 y Fn(let)44
b(rec)h(eval3)f(e)g(env)h(fenv)f(=)1943 5173 y Fp(9)p
eop
%%Page: 10 10
10 9 bop 523 448 a Fn(match)44 b(e)h(with)613 540 y(Int)f(i)h(->)f
(Some)g(i)523 631 y(|)h(Var)f(s)h(->)f(Some)g(\(env)h(s\))523
722 y(|)g(App)f(\(s,e2\))g(->)g(\(match)g(\(eval3)g(e2)g(env)h(fenv\))f
(with)1375 814 y(Some)g(x)h(->)f(\(fenv)g(s\))h(x)1285
905 y(|)g(None)134 b(->)44 b(None\))523 996 y(|)h(Add)f(\(e1,e2\))g(->)
g(\(match)g(\(eval3)g(e1)g(env)h(fenv,)f(eval3)g(e2)g(env)g(fenv\))1375
1088 y(with)g(\(Some)g(x,)g(Some)h(y\))f(->)h(Some)f(\(x+y\))1554
1179 y(|)h(_)f(->)h(None\))f(...)523 1270 y(|)h(Div)f(\(e1,e2\))g(->)g
(\(match)g(\(eval3)g(e1)g(env)h(fenv,)f(eval3)g(e2)g(env)g(fenv\))1375
1362 y(with)g(\(Some)g(x,)g(Some)h(y\))f(->)1689 1453
y(if)g(y=0)g(then)h(None)2002 1544 y(else)g(Some)f(\(x/y\))1509
1636 y(|)h(_)g(->)f(None\))523 1727 y(|)h(Ifz)f(\(e1,e2,e3\))f(->)i
(\(match)e(\(eval3)h(e1)h(env)f(fenv\))g(with)1509 1818
y(Some)g(x)h(->)g(if)f(x=0)g(then)h(\(eval3)e(e2)i(env)f(fenv\))2271
1910 y(else)h(\(eval3)e(e3)i(env)f(fenv\))1465 2001 y(|)g(None)134
b(->)44 b(None\))523 2153 y Fp(Compar)o(ed)22 b(to)i(the)f(original)h
(\(unstaged)f(interpr)o(eter\),)e(the)j(performance)e(over)o(head)g(of)
523 2245 y(adding)30 b(such)g(checks)h(is)f(mar)o(ginal.)f(But)h(what)h
(we)f(r)o(eally)f(car)o(e)g(about)h(is)g(the)g(staged)523
2336 y(setting.)21 b(Staging)g Fi(eval3)f Fp(yields:)523
2489 y Fn(let)44 b(rec)h(eval4)f(e)g(env)h(fenv)f(=)523
2580 y(match)g(e)h(with)613 2671 y(Int)f(i)h(->)f(.<Some)g(i>.)523
2763 y(|)h(Var)f(s)h(->)f(.<Some)g(.\230\(env)g(s\)>.)523
2854 y(|)h(App)f(\(s,e2\))g(->)g(.<\(match)g(.\230\(eval4)f(e2)i(env)f
(fenv\))g(with)1465 2945 y(Some)g(x)g(->)h(.\230\(fenv)e(s\))i(x)1375
3037 y(|)g(None)133 b(->)45 b(None\)>.)523 3128 y(|)g(Add)f(\(e1,e2\))g
(->)g(.<\(match)g(\(.\230\(eval4)f(e1)h(env)h(fenv\),)1733
3219 y(.\230\(eval4)f(e2)g(env)h(fenv\)\))f(with)1465
3311 y(\(Some)f(x,)i(Some)f(y\))h(->)f(Some)g(\(x+y\))1420
3402 y(|)g(_)h(->)f(None\)>.)g(...)523 3493 y(|)h(Div)f(\(e1,e2\))g(->)
g(.<\(match)g(\(.\230\(eval4)f(e1)h(env)h(fenv\),)1733
3585 y(.\230\(eval4)f(e2)g(env)h(fenv\)\))f(with)1465
3676 y(\(Some)f(x,)i(Some)f(y\))h(->)1554 3767 y(if)g(y=0)f(then)g
(None)1868 3859 y(else)g(Some)g(\(x/y\))1420 3950 y(|)g(_)h(->)f
(None\)>.)523 4041 y(|)h(Ifz)f(\(e1,e2,e3\))f(->)i(.<\(match)e
(.\230\(eval4)h(e1)g(env)g(fenv\))g(with)1599 4132 y(Some)g(x)h(->)f
(if)h(x=0)f(then)2137 4224 y(.\230\(eval4)f(e2)i(env)f(fenv\))2047
4315 y(else)2182 4406 y(.\230\(eval4)f(e3)i(env)f(fenv\))1509
4498 y(|)h(None)134 b(->)44 b(None\)>.)523 4650 y Fp(Unfortunately)27
b(we)f(\002nd)i(that)e(the)h(performance)f(of)h(code)f(generated)g(by)h
(this)g(staged)523 4742 y(interpr)o(eter)18 b(is)h(4)f(times)i(slower)f
(than)g(the)g(\002rst)g(staged)g(interpr)o(eter)e(\(with)j(no)f(err)o
(or)f(han-)523 4833 y(dling\).)25 b(The)h(sour)o(ce)f(of)g(the)h(r)o
(untime)g(cost)g(becomes)f(appar)o(ent)f(when)i(we)f(look)i(at)e(the)
523 4924 y(generated)20 b(code:)1922 5173 y(10)p eop
%%Page: 11 11
11 10 bop 523 448 a Fn(.<let)44 b(rec)g(f)h(=)658 540
y(fun)f(x)h(->)702 631 y(\(match)f(\(Some)g(\(x\)\))g(with)837
722 y(Some)g(\(x\))g(->)882 814 y(if)g(\(x)h(=)f(0\))h(then)f(\(Some)g
(\(1\)\))882 905 y(else)927 996 y(\(match)1061 1088 y(\(\(Some)g
(\(x\)\),)1106 1179 y(\(match)1240 1270 y(\(match)g(\(\(Some)g
(\(x\)\),)g(\(Some)g(\(1\)\)\))g(with)1375 1362 y(\(Some)g(\(x\),)g
(Some)g(\(y\)\))g(->)1420 1453 y(\(Some)g(\(\(x)g(-)h(y\)\)\))1285
1544 y(|)g(_)g(->)f(\(None\)\))g(with)1240 1636 y(Some)h(\(x\))f(->)g
(\(f)h(x\))1151 1727 y(|)f(None)h(->)f(\(None\)\)\))f(with)1061
1818 y(\(Some)h(\(x\),)g(Some)g(\(y\)\))g(->)1106 1910
y(\(Some)g(\(\(x)g(*)h(y\)\)\))971 2001 y(|)g(_)g(->)f(\(None\)\))747
2092 y(|)h(None)f(->)h(\(None\)\))e(in)613 2183 y(\(match)h(\(Some)g
(\(10\)\))g(with)747 2275 y(Some)g(\(x\))h(->)f(\(f)h(x\))658
2366 y(|)f(None)g(->)h(\(None\)\)>.)523 2542 y Fp(The)30
b(generated)f(code)h(is)g(doing)h(much)f(mor)o(e)g(work)g(than)g(befor)
o(e,)f(because)g(at)h(every)523 2641 y(operation)20 b(we)g(ar)o(e)f
(checking)i(to)f(see)g(if)g(the)g(values)g(we)g(ar)o(e)e(operating)i
(with)h(ar)o(e)e(pr)o(oper)523 2741 y(values)24 b(or)g(not.)g(Which)h
(branch)f(we)g(take)f(in)i(every)e Fi(match)h Fp(is)g(determined)f(by)h
(the)h(ex-)523 2840 y(plicit)c(form)g(of)g(the)g(value)f(being)h
(matched.)648 2943 y(One)27 b(solution)j(to)e(such)g(a)f(pr)o(oblem)g
(is)h(certainly)f(adding)g(a)g(pr)o(e-pr)o(ocessing)g(anal-)523
3043 y(ysis.)j(But)g(if)g(we)g(can)f(avoid)h(generating)g(such)g(inef)o
(\002cient)g(code)f(in)h(the)g(\002rst)h(place)e(it)523
3142 y(would)d(save)e(the)h(time)g(wasted)g(both)h(in)f(generating)g
(these)g(unnecessary)g(checks)g(and)523 3242 y(in)f(performing)g(the)f
(analysis.)h(Mor)o(e)e(importantly)-9 b(,)24 b(with)g(an)f(analysis,)h
(we)f(may)g(never)523 3342 y(be)28 b(certain)f(that)h(all)f
(unnecessary)h(computation)h(is)f(eliminated)g(fr)o(om)f(the)h
(generated)523 3441 y(code.)648 3544 y(The)18 b(sour)o(ce)g(of)g(the)g
(pr)o(oblem)g(is)h(the)f Fi(if)g Fp(statement)g(that)h(appears)d(in)j
(the)g(interpr)o(eta-)523 3644 y(tion)j(of)f Fi(Div)p
Fp(.)f(In)h(particular)-6 b(,)20 b(because)g Fi(y)h Fp(is)g(bound)g(at)
g(the)g(second)g(level)g(\(that)f(is,)i(inside)523 3743
y(code\),)h(we)h(cannot)g(perform)g(the)g(test)g Fi(y=0)g
Fp(early)-9 b(.)22 b(As)i(a)g(r)o(esult,)f(we)h(cannot)g(determine)523
3843 y(if)g(we)g(will)g(r)o(eturn)g(a)f Fi(None)g Fp(or)h(a)g
Fi(Some)f Fp(value.)g(Note)h(that)g(this)h(af)o(fects)d(the)i(type)g
(of)g(the)523 3943 y(whole)c(staged)f(interpr)o(eter)-6
b(,)18 b(and)h(ef)o(fects)f(the)i(way)f(we)g(interpr)o(et)g(all)g(pr)o
(ograms)g(\(even)g(if)523 4042 y(they)i(do)g(not)g(contain)h(a)e(use)h
(of)f(the)h Fi(Div)g Fp(constr)o(uct\).)648 4145 y(The)29
b(pr)o(oblem)g(can)g(be)h(avoided)e(by)i(what)f(is)h(called)f(a)g
Fk(binding-time)g(impr)o(ovement)523 4245 y Fp(in)f(the)g(partial)e
(evaluation)h(literatur)o(e)f([5].)g(It)i(is)g(essentially)g(a)f
(transformation)g(of)h(the)523 4344 y(pr)o(ogram)23 b(that)g(we)g(ar)o
(e)f(staging.)i(The)f(goal)h(of)f(this)i(transformation)e(is)h(to)g
(allow)g(better)523 4444 y(staging.)f(In)h(the)f(case)f(of)h(the)g
(above)g(example,)f(one)h(ef)o(fective)f(binding)h(time)h(impr)o(ove-)
523 4543 y(ment)c(is)g(to)h(r)o(ewrite)e(the)h(interpr)o(eter)e(in)i
(continuation-passing)i(style)e(\(CPS\))f([3)o(],)g(which)523
4643 y(pr)o(oduces)h(the)h(following)h(code:)523 4833
y Fn(let)44 b(rec)h(eval5)f(e)g(env)h(fenv)f(k)g(=)523
4924 y(match)g(e)h(with)1922 5173 y Fp(11)p eop
%%Page: 12 12
12 11 bop 613 448 a Fn(Int)44 b(i)h(->)f(k)h(\(Some)f(i\))523
540 y(|)h(Var)f(s)h(->)f(k)h(\(Some)f(\(env)g(s\)\))523
631 y(|)h(App)f(\(s,e2\))g(->)g(eval5)g(e2)h(env)f(fenv)1330
722 y(\(fun)g(r)h(->)f(match)g(r)h(with)1420 814 y(Some)f(x)g(->)h(k)g
(\(Some)f(\(\(fenv)f(s\))i(x\)\))1330 905 y(|)g(None)133
b(->)45 b(k)g(None\))523 996 y(|)g(Add)f(\(e1,e2\))g(->)g(eval5)g(e1)h
(env)f(fenv)1375 1088 y(\(fun)g(r)h(->)1465 1179 y(eval5)e(e2)i(env)f
(fenv)1554 1270 y(\(fun)g(s)h(->)f(match)g(\(r,s\))g(with)1644
1362 y(\(Some)g(x,)g(Some)g(y\))h(->)f(k)h(\(Some)f(\(x+y\)\))1599
1453 y(|)h(_)f(->)h(k)f(None\)\))g(...)523 1544 y(|)h(Div)f(\(e1,e2\))g
(->)g(eval5)g(e1)h(env)f(fenv)1375 1636 y(\(fun)g(r)h(->)1465
1727 y(eval5)e(e2)i(env)f(fenv)1554 1818 y(\(fun)g(s)h(->)f(match)g
(\(r,s\))g(with)1644 1910 y(\(Some)g(x,)g(Some)g(y\))h(->)1733
2001 y(if)g(y=0)f(then)g(k)h(None)2137 2092 y(else)f(k)h(\(Some)f
(\(x/y\)\))1599 2183 y(|)h(_)f(->)h(k)f(None\)\))g(...)523
2366 y(let)g(rec)h(pevalK5)e(p)i(env)f(fenv)g(k)h(=)702
2457 y(match)f(p)h(with)747 2549 y(Program)f(\([],e\))g(->)g(eval5)g(e)
h(env)f(fenv)g(k)702 2640 y(|Program)g(\(Declaration)f
(\(s1,s2,e1\)::tl,e\))f(->)882 2731 y(let)i(rec)g(f)h(x)g(=)f(eval5)g
(e1)h(\(ext)f(env)g(s2)h(x\))f(\(ext)g(fenv)h(s1)f(f\))h(k)971
2823 y(in)g(pevalK5)f(\(Program\(tl,e\)\))e(env)i(\(ext)g(fenv)g(s1)h
(f\))f(k)523 3005 y(exception)f(Div_by_zero;;)523 3188
y(let)h(peval5)g(p)h(env)f(fenv)g(=)747 3279 y(pevalK5)g(p)h(env)f
(fenv)g(\(function)f(Some)h(x)h(->)g(x)1958 3371 y(|)f(None)g(->)h
(raise)f(Div_by_zero\))523 3562 y Fp(In)29 b(the)h(unstaged)f(setting,)
g(we)g(can)g(use)g(the)g(CPS)g(implementation)h(to)g(get)f(the)g(same)
523 3654 y(functionality)34 b(as)e(the)h(dir)o(ect-style)f
(implementation.)i(But)e(note)i(that)f(the)g(two)g(algo-)523
3745 y(rithms)27 b(ar)o(e)e Fk(not)h(the)f(same)p Fp(.)h(For)h
(example,)e(performance)g(of)h(the)g(CPS)g(interpr)o(eter)f(is)h(in)523
3836 y(fact)19 b(worse)i(than)g(the)f(pr)o(evious)g(one.)h(But)f(when)h
(we)f(try)h(to)g(stage)f(new)g(interpr)o(eter)-6 b(,)19
b(we)523 3928 y(\002nd)29 b(that)f(we)g(can)g(do)h(something)h(that)e
(we)g(could)h(not)g(do)f(in)h(the)f(dir)o(ect-style)g(inter)o(-)523
4019 y(pr)o(eter)-6 b(.)19 b(In)i(particular)-6 b(,)19
b(the)i(CPS)f(interpr)o(eter)g(can)g(be)h(staged)f(as)g(follows:)523
4194 y Fn(let)44 b(rec)h(eval6)f(e)g(env)h(fenv)f(k)g(=)523
4285 y(match)g(e)h(with)613 4376 y(Int)f(i)h(->)f(k)h(\(Some)f(.<i>.\))
523 4468 y(|)h(Var)f(s)h(->)f(k)h(\(Some)f(\(env)g(s\)\))523
4559 y(|)h(App)f(\(s,e2\))g(->)g(eval6)g(e2)h(env)f(fenv)1330
4650 y(\(fun)g(r)h(->)f(match)g(r)h(with)1420 4742 y(Some)f(x)g(->)h(k)
g(\(Some)f(.<.\230\(fenv)f(s\))h(.\230x>.\))1330 4833
y(|)h(None)133 b(->)45 b(k)g(None\))523 4924 y(|)g(Add)f(\(e1,e2\))g
(->)g(eval6)g(e1)h(env)f(fenv)1922 5173 y Fp(12)p eop
%%Page: 13 13
13 12 bop 1375 448 a Fn(\(fun)44 b(r)h(->)1465 540 y(eval6)e(e2)i(env)f
(fenv)1554 631 y(\(fun)g(s)h(->)f(match)g(\(r,s\))g(with)1644
722 y(\(Some)g(x,)g(Some)g(y\))h(->)1733 814 y(k)g(\(Some)f(.<.\230x)g
(+)h(.\230y>.\))1599 905 y(|)g(_)f(->)h(k)f(None\)\))g(...)523
996 y(|)h(Div)f(\(e1,e2\))g(->)g(eval6)g(e1)h(env)f(fenv)1375
1088 y(\(fun)g(r)h(->)1465 1179 y(eval6)e(e2)i(env)f(fenv)1554
1270 y(\(fun)g(s)h(->)f(match)g(\(r,s\))g(with)1644 1362
y(\(Some)g(x,)g(Some)g(y\))h(->)1733 1453 y(.<if)g(.\230y=0)f(then)g
(.\230\(k)g(None\))1823 1544 y(else)g(.\230\(k)g(\(Some)g(.<.\230x)g(/)
h(.\230y>.\)\)>.)1599 1636 y(|)g(_)f(->)h(k)f(None\)\))523
1727 y(|)h(Ifz)f(\(e1,e2,e3\))f(->)i(eval6)f(e1)g(env)g(fenv)1509
1818 y(\(fun)g(r)h(->)g(match)f(r)g(with)1599 1910 y(Some)g(x)h(->)f
(.<if)g(.\230x=0)g(then)2271 2001 y(.\230\(eval6)g(e2)g(env)h(fenv)f
(k\))2137 2092 y(else)2271 2183 y(.\230\(eval6)g(e3)g(env)h(fenv)f
(k\)>.)1554 2275 y(|)h(None)134 b(->)44 b(k)h(None\))523
2457 y(let)f(peval6)g(p)h(env)f(fenv)g(=)747 2549 y(pevalK6)g(p)h(env)f
(fenv)g(\(function)f(Some)h(x)h(->)g(x)1958 2640 y(|)f(None)g(->)h
(.<raise)f(Div_by_zero>.\))523 2812 y Fp(What)20 b(we)g(could)g(not)g
(do)g(befor)o(e)f(but)h(we)g(can)g(do)g(her)o(e)f(is)h(to)g(Escape)f
(the)h(application)g(of)523 2911 y(the)i(continuation)h(to)f(the)g
(branches)f(of)h(the)g Fi(if)f Fp(statement)h(in)g(the)f
Fi(Div)h Fp(case.)e(The)i(extra)523 3011 y(advantage)i(that)g(we)i
(have)e(when)i(staging)f(a)g(CPS)f(pr)o(ogram)h(is)g(that)g(we)g(ar)o
(e)f(applying)523 3111 y(the)g(continuation)i(multiple)f(times,)f
(which)h(is)g(essential)f(for)g(performing)g(the)h(compu-)523
3210 y(tation)d(in)h(the)f(branches)g(of)g(an)f Fi(if)h
Fp(statement.)g(Note)g(that)g(in)g(the)g(unstaged)g(CPS)g(inter)o(-)523
3310 y(pr)o(eter)-6 b(,)24 b(the)i(continuation)h(is)f(always)g(used)f
(exactly)h(once.)f(In)h(the)g(staged)g(interpr)o(eter)-6
b(,)523 3410 y(in)26 b(cases)f(similar)g(to)h(the)f Fi(if)g
Fp(statement)g(above,)g(the)g(continuation)i(is)e(duplicated)f(and)523
3509 y(applied)c(multiple)h(times.)1377 3479 y Fg(3)648
3602 y Fp(The)i(staged)g(CPS)g(interpr)o(eter)f(generates)g(code)h
(that)h(is)f(exactly)g(the)h(same)f(as)g(what)523 3694
y(we)h(got)h(fr)o(om)e(the)i(\002rst)f(interpr)o(eter)-6
b(.)23 b(This)h(will)h(always)f(be)g(the)g(case)f(when)i(the)f(sour)o
(ce)523 3785 y(pr)o(ogram)19 b(does)g(not)h(use)g(the)g(division)g
(operation.)f(When)h(we)g(use)f(division)i(operations)523
3876 y(\(say)-9 b(,)17 b(if)h(we)h(r)o(eplace)d(the)j(code)e(in)i(the)g
(body)f(of)g(the)h(fact)e(example)g(with)i Fi(fact)49
b(\(20/2\))p Fp(\))523 3968 y(we)21 b(get)g(the)f(following)j(code:)523
4133 y Fn(.<let)44 b(rec)g(f)h(=)658 4224 y(fun)f(x)h(->)f(if)h(\(x)f
(=)h(0\))f(then)g(1)h(else)f(\(x)h(*)f(\(f)h(\(x)f(-)h(1\)\)\))613
4316 y(in)f(if)h(\(2)f(=)h(0\))f(then)h(\(raise)e(\(Div_by_zero\)\))g
(else)h(\(f)g(\(20)h(/)f(2\)\)>.)648 4479 y Fp(So)28
b(far)g(we)h(have)g(focused)f(on)i(eliminating)g(unnecessary)f(work)g
(fr)o(om)g(generated)523 4570 y(pr)o(ograms.)c(Can)g(we)g(do)g(better?)
g(One)g(way)g(in)h(which)g(MSP)f(can)g(help)g(us)h(do)f(better)g(is)p
523 4654 473 4 v 558 4710 a Ff(3)606 4742 y Fo(Note)j(that)h(this)e
(also)g(means)h(that)h(converting)f(a)g(pr)o(ogram)d(into)j(CPS)g(can)h
(have)f(disadvan-)606 4833 y(tages)15 b(\(such)h(as)f(a)h
(computationally)f(expensive)f(\002rst)i(stage,)e(and)i(possibly)e
(code)g(duplication\).)606 4924 y(Thus,)k(it)h(must)g(be)g(used)f(with)
h(car)o(e)f([6)q(].)1922 5173 y Fp(13)p eop
%%Page: 14 14
14 13 bop 523 448 a Fp(by)18 b(allowing)h(us)g(to)f(unfold)g(function)h
(declarations)f(for)g(a)f(\002xed)h(number)g(of)g(times.)g(This)523
540 y(is)j(easy)g(to)g(incorporate)f(into)i(the)f(\002rst)g(staged)f
(interpr)o(eter)f(as)i(follows:)523 729 y Fn(let)44 b(rec)h(eval7)f(e)g
(env)h(fenv)f(=)523 820 y(match)g(e)h(with)523 912 y(...)f(most)h
(cases)f(the)g(same)g(as)g(eval2,)g(except)523 1003 y(|)h(App)f
(\(s,e2\))g(->)g(fenv)h(s)f(\(eval7)g(e2)g(env)h(fenv\))523
1186 y(let)f(rec)h(inline)f(n)g(body)g(=)613 1277 y(if)g(n=0)h(then)f
(body)g(else)g(fun)g(x)h(->)f(body)h(\(inline)e(\(n-1\))h(body)g(x\))
523 1460 y(let)g(rec)h(peval7)f(p)g(env)h(fenv=)702 1551
y(match)f(p)h(with)747 1642 y(Program)f(\([],e\))g(->)g(eval7)g(e)h
(env)f(fenv)702 1734 y(|Program)g(\(Declaration)f(\(s1,s2,e1\)::tl,e\))
f(->)882 1825 y(.<let)i(rec)g(f)h(x)f(=)1061 1916 y(.\230\(let)g(body)g
(cf)g(x)h(=)1420 2008 y(eval7)f(e1)g(\(ext)g(env)h(s2)f(x\))h(\(ext)f
(fenv)g(s1)g(cf\))h(in)1196 2099 y(inline)e(1)i(body)f(\(fun)g(y)h(->)f
(.<f)h(.\230y>.\))f(.<x>.\))971 2190 y(in)h(.\230\(peval7)e
(\(Program\(tl,e\)\))f(env)1554 2282 y(\(ext)i(fenv)g(s1)h(\(fun)f(y)h
(->)f(.<f)h(.\230y>.\)\)\)>.)523 2463 y Fp(The)21 b(code)f(generated)g
(for)g(the)h(factorial)f(example)g(is)h(as)g(follows:)523
2653 y Fn(.<let)44 b(rec)g(f)h(=)658 2744 y(fun)f(x)h(->)702
2835 y(if)g(\(x)f(=)h(0\))g(then)f(1)702 2927 y(else)747
3018 y(\(x*\(if)g(\(\(x-1\)=0\))f(then)h(1)h(else)f(\(x-1\)*\(f)g
(\(\(x-1\)-1\)\)\)\)\))613 3109 y(in)g(\(f)h(10\)>.)523
3299 y Fp(This)25 b(code)f(r)o(uns)h(faster)e(than)i(that)f(pr)o
(oduced)f(by)h(the)h(\002rst)f(staged)g(interpr)o(eter)-6
b(.)22 b(It)j(also)523 3399 y(points)31 b(out)f(an)f(important)h(issue)
g(that)f(the)h(multi-stage)g(pr)o(ogrammer)e(must)j(pay)e(at-)523
3498 y(tention)23 b(to:)e(code)g(duplication.)h(Notice)f(that)h(the)f
(term)h Fi(x-1)f Fp(occurs)g(thr)o(ee)g(times)h(in)g(the)523
3598 y(generated)e(code.)g(In)h(the)g(r)o(esult)f(of)h(the)g(\002rst)g
(staged)f(interpr)o(eter)-6 b(,)19 b(the)i(subtraction)g(only)523
3698 y(occurr)o(ed)26 b(once.)i(The)g(duplication)g(of)g(this)g(term)g
(is)g(a)f(r)o(esult)g(of)h(the)g(inlining)h(that)f(we)523
3797 y(perform)h(on)i(the)e(body)h(of)g(the)g(function.)g(If)f(the)h
(ar)o(gument)f(to)h(a)f(r)o(ecursive)g(call)g(was)523
3897 y(even)22 b(bigger)-6 b(,)22 b(then)g(code)g(duplication)h(would)g
(have)e(a)h(mor)o(e)g(dramatic)f(ef)o(fect)f(both)j(on)523
3996 y(the)e(time)g(needed)f(to)h(compile)g(the)g(pr)o(ogram)f(and)g
(the)h(time)g(needed)f(to)h(r)o(un)h(it.)648 4096 y(A)k(simple)h
(solution)h(to)f(this)h(pr)o(oblem)e(comes)h(fr)o(om)g(the)g(partial)e
(evaluation)i(com-)523 4187 y(munity:)h(we)g(can)f(generate)f
Fi(let)h Fp(statements)h(that)f(r)o(eplace)f(the)h(expr)o(ession)g
(about)h(to)523 4278 y(be)g(duplicated)f(by)h(a)g(simple)g(variable.)f
(This)h(is)h(only)g(a)e(small)i(change)f(to)g(the)g(staged)523
4370 y(interpr)o(eter)19 b(pr)o(esented)h(above:)523
4559 y Fn(let)44 b(rec)h(eval8)f(e)g(env)h(fenv)f(=)523
4650 y(match)g(e)h(with)523 4742 y(...)f(same)h(as)f(eval7)g(except)g
(for)523 4833 y(|)h(App)f(\(s,e2\))g(->)g(.<let)g(x=)h(.\230\(eval8)e
(e2)i(env)f(fenv\))1330 4924 y(in)h(.\230\(fenv)e(s)i(.<x>.\)>.)e(...)
1922 5173 y Fp(14)p eop
%%Page: 15 15
15 14 bop 523 448 a Fp(Unfortunately)-9 b(,)24 b(in)g(the)h(curr)o(ent)
e(implementation)i(of)g(MetaOCaml)e(this)i(change)f(does)523
548 y(not)19 b(lead)e(to)h(a)f(performance)g(impr)o(ovement.)h(The)g
(most)h(likely)f(r)o(eason)f(is)i(that)e(the)h(byte-)523
648 y(code)23 b(compiler)g(does)f(not)i(seem)f(to)g(perform)f
Fi(let)p Fp(-\003oating.)h(In)g(the)g(native)f(code)h(com-)523
747 y(piler)h(for)g(MetaOCaml)g(\(curr)o(ently)f(under)h(development\))
g(we)h(expect)e(this)i(change)g(to)523 847 y(be)20 b(an)h(impr)o
(ovement.)648 943 y(Finally)-9 b(,)32 b(both)h(err)o(or)e(handling)i
(and)f(inlining)j(can)d(be)g(combined)g(into)i(the)e(same)523
1035 y(implementation:)523 1213 y Fn(let)44 b(rec)h(eval9)f(e)g(env)h
(fenv)f(k)g(=)523 1304 y(match)g(e)h(with)523 1395 y(...)f(same)h(as)f
(eval6,)g(except)523 1487 y(|)h(App)f(\(s,e2\))g(->)g(eval9)g(e2)h(env)
f(fenv)1330 1578 y(\(fun)g(r)h(->)f(match)g(r)h(with)1420
1669 y(Some)f(x)g(->)h(k)g(\(Some)f(\(\(fenv)f(s\))i(x\)\))1330
1760 y(|)g(None)133 b(->)45 b(k)g(None\))523 1943 y(let)f(rec)h
(pevalK9)e(p)i(env)f(fenv)g(k)h(=)702 2034 y(match)f(p)h(with)747
2126 y(Program)f(\([],e\))g(->)g(eval9)g(e)h(env)f(fenv)g(k)702
2217 y(|Program)g(\(Declaration)f(\(s1,s2,e1\)::tl,e\))f(->)882
2308 y(.<let)i(rec)g(f)h(x)f(=)971 2400 y(.\230\(let)g(body)g(cf)h(x)f
(=)1330 2491 y(eval9)g(e1)g(\(ext)h(env)f(s2)g(x\))h(\(ext)f(fenv)g(s1)
h(cf\))f(k)h(in)1106 2582 y(inline)f(1)g(body)g(\(fun)h(y)f(->)h(.<f)f
(.\230y>.\))g(.<x>.\))971 2674 y(in)h(.\230\(pevalK9)e
(\(Program\(tl,e\)\))f(env)1599 2765 y(\(ext)i(fenv)g(s1)h(\(fun)f(y)h
(->)f(.<f)g(.\230y>.\)\))g(k\)>.)523 3039 y Fj(3.1)82
b(Measuring)19 b(Performance)523 3223 y Fp(MetaOCaml)24
b(pr)o(ovides)g(support)i(for)e(collecting)i(performance)e(data,)g(so)h
(that)g(we)g(can)523 3314 y(verify)h(that)h(staging)h(a)e(pr)o(ogram)h
(actually)f(r)o(esults)h(in)g(changing)h(the)f(time)h(it)f(takes)g(to)
523 3405 y(compute)f(it.)g(This)g(is)g(done)g(using)g(thr)o(ee)f
(simple)h(functions.)g(The)g(\002rst)g(function)g(must)523
3497 y(be)20 b(called)g(befor)o(e)g(we)h(start)f(collecting)i(timings.)
g(It)e(is)h(called)f(as)h(follows:)523 3675 y Fn(Trx.init_times)43
b(\(\);;)523 3847 y Fp(The)23 b(second)g(function)g(is)g(invoked)g
(when)g(we)g(want)g(to)g(gather)f(timings.)i(Her)o(e)e(we)g(call)523
3939 y(it)g(twice)h(on)g(both)g Fi(power2)48 b(\(3\))22
b Fp(and)g Fi(power2'\(3\))e Fp(wher)o(e)i Fi(power2')f
Fp(is)h(the)g(staged)523 4030 y(version:)523 4208 y Fn(Trx.timenew)43
b("Normal")h(\(fun)g(\(\))g(->\(power2)88 b(\(3\)\)\);;)523
4299 y(Trx.timenew)43 b("Staged")h(\(fun)g(\(\))g(->\(power2')f
(\(3\)\)\);;)523 4472 y Fp(Each)16 b(call)g(causes)g(the)g(ar)o(gument)
g(passed)f(last)i(to)f(be)g(r)o(un)h(as)f(many)g(times)h(as)f(this)h
(system)523 4564 y(needs)22 b(to)h(gather)f(a)g(r)o(eliable)f(timing.)i
(The)g(quoted)g(strings)g(simply)g(pr)o(ovide)f(hints)h(that)523
4655 y(will)f(be)f(printed)f(when)i(we)f(decide)f(to)i(print)f(the)g
(summary)h(of)f(the)g(timings.)h(The)f(thir)o(d)523 4746
y(function)h(prints)f(a)f(summary)h(of)g(timings:)523
4924 y Fn(Trx.print_times)42 b(\(\);;)1922 5173 y Fp(15)p
eop
%%Page: 16 16
16 15 bop 523 448 a Fp(The)27 b(following)h(table)f(summarizes)g
(timings)h(for)f(the)g(various)g(functions)h(consider)o(ed)523
548 y(in)21 b(the)g(pr)o(evious)g(section:)1373 518 y
Fg(4)p 786 651 2357 4 v 784 750 4 100 v 818 720 a Fj(Program)p
1172 750 V 65 w(Description)e(of)i(Interpreter)p 2347
750 V 225 w Fi(Fact10)p 2769 750 V 122 w(Fib20)p 3140
750 V 786 754 2357 4 v 784 853 4 100 v 868 823 a Fk(\(none\))p
1172 853 V 100 w Fp(OCaml)g(implementations)p 2347 853
V 434 w(100\045)p 2769 853 V 176 w(100\045)p 3140 853
V 784 953 V 847 923 a Fi(eval1)p 1172 953 V 88 w Fp(Simple)p
2347 953 V 1021 w(1,570\045)p 2769 953 V 133 w(1,736\045)p
3140 953 V 784 1052 V 847 1023 a Fi(eval2)p 1172 1052
V 88 w Fp(Simple)g(staged)p 2347 1052 V 821 w(100\045)p
2769 1052 V 176 w(100\045)p 3140 1052 V 784 1152 V 847
1122 a Fi(eval3)p 1172 1152 V 88 w Fp(Err)o(or)f(handling)h(\(EH\))p
2347 1152 V 534 w(1,903\045)p 2769 1152 V 133 w(2,138\045)p
3140 1152 V 784 1252 V 847 1222 a Fi(eval4)p 1172 1252
V 88 w Fp(EH)g(staged)p 2347 1252 V 956 w(417\045)p 2769
1252 V 176 w(482\045)p 3140 1252 V 784 1351 V 847 1321
a Fi(eval5)p 1172 1351 V 88 w Fp(CPS,)f(EH)p 2347 1351
V 962 w(2,470\045)p 2769 1351 V 133 w(2,814\045)p 3140
1351 V 784 1451 V 847 1421 a Fi(eval6)p 1172 1451 V 88
w Fp(CPS,)g(EH,)h(staged)p 2347 1451 V 741 w(100\045)p
2769 1451 V 176 w(100\045)p 3140 1451 V 784 1551 V 847
1521 a Fi(eval7)p 1172 1551 V 88 w Fp(Inlining,)h(staged)p
2347 1551 V 805 w(87\045)p 2769 1551 V 218 w(85\045)p
3140 1551 V 784 1650 V 847 1620 a Fi(eval8)p 1172 1650
V 88 w Fp(Inlining,)g(no)g(duplication,)e(staged)p 2347
1650 V 227 w(97\045)p 2769 1650 V 218 w(97\045)p 3140
1650 V 784 1750 V 847 1720 a Fi(eval9)p 1172 1750 V 88
w Fp(Inlining,)i(CPS,)e(EH,)h(staged)p 2347 1750 V 449
w(90\045)p 2769 1750 V 218 w(85\045)p 3140 1750 V 786
1753 2357 4 v 523 1889 a(T)-5 b(imings)25 b(ar)o(e)d(normalized)g(r)o
(elative)g(to)i(writing)g(the)f(two)h(example)e(pr)o(ograms)h(that)g
(we)523 1989 y(ar)o(e)c(interpr)o(eting)i(\()p Fi(Fact10)e
Fp(and)h Fi(Fib20)p Fp(\).)523 2240 y Fj(3.2)82 b(Recognizing)19
b(Opportunities)f(for)j(Using)f(MSP)523 2407 y Fp(The)27
b(extent)f(to)i(which)f(MSP)f(is)i(ef)o(fective)c(is)k(often)e
(dictated)g(by)h(the)g(surr)o(ounding)g(en-)523 2507
y(vir)o(onment)e(in)f(which)h(an)f(algorithm,)g(pr)o(ogram,)f(or)i
(system)f(is)h(to)f(be)g(used.)f(Ther)o(e)g(ar)o(e)523
2606 y(thr)o(ee)d(important)h(examples)f(of)h(situations)h(wher)o(e)e
(staging)h(can)g(be)f(bene\002cial:)581 2774 y Fj(\226)41
b Fp(W)-8 b(e)23 b(want)g(to)g(minimize)h(total)f(cost)g(of)g(all)f
(stages)h Fk(for)g(most)f(inputs)p Fp(.)g(This)i(model)f(ap-)664
2873 y(plies,)17 b(for)g(example,)f(to)h(implementations)i(of)e(pr)o
(ogramming)g(languages.)f(The)h(cost)664 2973 y(of)i(a)f(simple)h
(compilation)g(followed)g(by)g(execution)g(is)g Fk(usually)f
Fp(lower)h(than)g(the)f(cost)664 3073 y(of)32 b(interpr)o(etation.)f
(For)i(example,)e(the)h(pr)o(ogram)f(being)i(executed)d(usually)j(con-)
664 3172 y(tains)27 b(loops,)g(which)h(typically)f(incur)f(lar)o(ge)g
(over)o(head)f(in)i(an)g(interpr)o(eted)e(imple-)664
3272 y(mentation.)581 3372 y Fj(\226)41 b Fp(W)-8 b(e)19
b(want)f(to)h(minimize)g Fk(a)g(weighted)e(average)h
Fp(of)g(the)h(cost)g(of)f(all)h(stages.)f(The)g(weights)664
3471 y(r)o(e\003ect)27 b(the)g(r)o(elative)g(fr)o(equency)f(at)h(which)
i(the)e(r)o(esult)g(of)h(a)f(stage)g(can)g(be)g(r)o(eused.)664
3571 y(This)32 b(situation)f(is)h(r)o(elevant)d(in)i(many)h
(applications)f(of)f(symbolic)i(computation.)664 3671
y(Often,)d(solving)h(a)e(pr)o(oblem)g(symbolically)-9
b(,)30 b(and)e(then)h(graphing)g(the)g(solution)h(at)664
3770 y(a)25 b(thousand)h(points)g(can)f(be)g(cheaper)f(than)i
(numerically)f(solving)i(the)e(pr)o(oblem)g(a)664 3870
y(thousand)17 b(times.)g(This)g(cost)g(model)g(can)f(make)g(a)g
(symbolic)h(appr)o(oach)f(worthwhile)664 3969 y(even)23
b(when)h(it)g(is)f(100)f(times)i(mor)o(e)f(expensive)g(than)h(a)e(dir)o
(ect)h(numerical)g(one.)g(\(By)664 4069 y(symbolic)k(computation)g(we)f
(simply)h(mean)f(computation)h(wher)o(e)e(fr)o(ee)g(variables)664
4169 y(ar)o(e)20 b(values)g(that)h(will)g(only)h(become)e(available)g
(at)g(a)g(later)g(stage.\))581 4269 y Fj(\226)41 b Fp(W)-8
b(e)23 b(want)h(to)f(minimize)h(the)f(cost)g(of)g(the)h
Fk(last)f(stage)p Fp(.)f(Consider)h(an)g(embedded)f(sys-)664
4368 y(tem)k(wher)o(e)f(the)g Fe(sin)g Fp(function)i(may)e(be)g
(implemented)h(as)f(a)g(lar)o(ge)g(look-up)h(table.)664
4468 y(The)34 b(cost)f(of)h(constr)o(ucting)h(the)e(table)g(is)h(not)g
(r)o(elevant.)e(Only)i(the)g(cost)f(of)h(com-)664 4568
y(puting)e(the)g(function)h(at)e(r)o(un-time)h(is.)g(The)f(same)h
(applies)f(to)h(optimizing)h(com-)664 4667 y(pilers,)d(which)i(may)e
(spend)h(an)f(unusual)h(amount)g(of)g(time)g(to)g(generate)e(a)h(high-)
p 523 4745 473 4 v 558 4801 a Ff(4)606 4833 y Fo(System)20
b(speci\002cations:)h(MetaOCaml)g(bytecode)f(interpr)o(eter)f(r)o
(unning)j(under)e(Cygwin)g(on)i(a)606 4924 y(Pentium)d(III)h(machine,)f
(Mobile)f(CPU,)g(1133MHz)j(clock,)c(175)j(MHz)f(bus,)f(640)i(MB)e(RAM.)
1922 5173 y Fp(16)p eop
%%Page: 17 17
17 16 bop 664 448 a Fp(performance)31 b(computational)h(library)-9
b(.)30 b(The)h(cost)h(of)g(optimization)g(is)g(often)f(not)664
548 y(r)o(elevant)20 b(to)h(the)g(users)g(of)f(such)h(libraries)2012
518 y Fg(5)2045 548 y Fp(.)648 720 y(The)i(last)h(model)g(seems)f(to)h
(be)g(the)f(most)i(commonly)g(r)o(efer)o(enced)c(one)j(in)g(the)g
(liter)o(-)523 820 y(atur)o(e,)c(and)h(is)g(often)h(described)e(as)h
(\223ther)o(e)f(is)i(ample)f(time)h(between)f(the)g(arrival)f(of)i
(dif-)523 919 y(fer)o(ent)c(inputs\224,)h(\223ther)o(e)f(is)h(a)g
(signi\002cant)h(dif)o(fer)o(ence)c(between)j(the)g(fr)o(equency)f(at)h
(which)523 1019 y(the)g(various)g(inputs)g(to)g(a)g(pr)o(ogram)f
(change\224,)g(and)g(\223the)g(performance)g(of)h(the)g(pr)o(ogram)523
1119 y(matters)i(only)g(after)f(the)h(arrival)e(of)i(its)g(last)g
(input\224.)523 1378 y Fj(3.3)82 b(Summary)20 b(and)f(Remarks)h(on)g
(Correctness)523 1554 y Fp(The)c(sequence)h(of)f(interpr)o(eters)g(pr)o
(esented)f(her)o(e)g(is)i(intended)f(to)h(illustrate)f(the)h(iterative)
523 1654 y(natur)o(e)23 b(of)h(the)g(pr)o(ocess)g(of)g(exploring)g(how)
h(to)g(stage)e(an)h(interpr)o(eter)f(so)h(that)g(it)h(can)e(be)523
1753 y(turned)f(into)g(a)g(corr)o(ect)f(translator)-6
b(,)21 b(which)i(when)f(composed)h(with)f(the)g(Run)h(constr)o(uct)523
1853 y(of)e(MetaOCaml,)e(gives)i(a)f(compiler)h(for)g(the)g(DSL.)648
1955 y(T)-8 b(o)23 b(r)o(eason)f(about)h(the)g(corr)o(ectness)f(of)h
(the)g(r)o(esulting)g(translator)-6 b(,)22 b(the)h(pr)o(ogrammer)523
2054 y(needs)c(to)h(know)h(that)e(ther)o(e)g(is)h(a)f(well-de\002ned)g
(semantics)h(for)f(multi-stage)g(languages,)523 2154
y(and)e(that)h(this)g(semantics)g(admit)g(simple)g(r)o(easoning)g
(principles)g([15)n(].)g(The)f(basic)h(r)o(educ-)523
2254 y(tions)k(ar)o(e)d(as)i(follows:)1488 2420 y Fd(\()p
Fe(\025x:v)1681 2390 y Fc(1)1678 2441 y(1)1719 2420 y
Fd(\))14 b Fe(v)1808 2390 y Fc(0)1805 2441 y(2)1952 2420
y Fd(=)106 b Fe(v)2166 2390 y Fc(1)2163 2441 y(1)2203
2420 y Fd([)p Fe(x)24 b Fd(:=)f Fe(v)2451 2390 y Fc(0)2448
2441 y(2)2488 2420 y Fd(])1417 2553 y Fi(.\230)49 b(.<)p
Fe(v)1709 2523 y Fc(1)1746 2553 y Fi(>.)106 b Fd(=)g
Fe(v)2166 2523 y Fc(1)1417 2686 y Fi(.!)49 b(.<)p Fe(v)1709
2656 y Fc(1)1746 2686 y Fi(>.)106 b Fd(=)g Fe(v)2166
2656 y Fc(1)523 2879 y Fp(wher)o(e)22 b Fe(v)817 2848
y Fc(0)878 2879 y Fp(includes)h(usual)g(values)f(as)h(well)g(as)g(code)
f(fragments)h(wher)o(e)f(all)h(the)g(level)f(1)523 2978
y(escapes)e(have)h(been)g(performed,)f(and)h(wher)o(e)f
Fe(v)2103 2948 y Fc(1)2162 2978 y Fp(is)h(an)g(expr)o(ession)g(wher)o
(e)g(all)g(escapes)523 3078 y(ar)o(e)h(enclosed)h(by)g(a)g(matching)g
(set)g(of)g(brackets.)f(Note)i(that)f(the)g(r)o(ules)g(for)g(escapes)f
(and)523 3177 y(brackets)32 b(ar)o(e)f(identical.)i(The)f(distinction)i
(between)f(the)g(two)g(is)g(not)h(explicit)f(in)g(the)523
3277 y(r)o(ules,)e(but)f(certainly)g(exists)h(in)g(the)f(notion)i(of)f
(values:)f(a)g Fe(v)2520 3247 y Fc(1)2587 3277 y Fp(values)h(cannot)f
(contain)523 3377 y(escapes)22 b(without)j(surr)o(ounding)e(brackets,)f
(but)h(it)h(is)f(unconstrained)h(as)e(to)i(wher)o(e)e(r)o(un)523
3476 y(can)e(occur)-6 b(.)523 3752 y Fl(4)99 b(T)-11
b(o)26 b(Probe)f(Further)523 3962 y Fp(Other)i(detailed)f(examples)h
(of)g(multi-stage)g(pr)o(ogramming)g(can)g(be)g(found)g(in)h(the)f
(lit-)523 4061 y(eratur)o(e,)22 b(including)j(term-r)o(ewriting)f
(systems)h([14)n(])f(and)g(graph)g(algorithms)h([10)n(].)f(The)523
4161 y(most)17 b(r)o(elevant)d(example)h(to)h(domain-speci\002c)g(pr)o
(ogram)f(generation)h(is)g(on)h(implement-)523 4260 y(ing)j(a)f(small)h
(imperative)e(language)h([13)o(].)g(The)g(pr)o(esent)g(tutorial)g
(should)h(serve)f(as)g(good)523 4360 y(pr)o(eparation)g(for)i(appr)o
(oaching)f(the)h(latter)f(example.)648 4462 y(An)25 b(implicit)i(goal)f
(of)g(this)h(tutorial)f(is)g(to)g(pr)o(epar)o(e)e(the)i(r)o(eader)d(to)
k(appr)o(oach)d(intr)o(o-)523 4561 y(ductions)h(to)g(partial)f
(evaluation)h([2)o(])f(and)g(partial)g(evaluation)g(of)h(interpr)o
(eters)e(in)j(par)o(-)523 4661 y(ticular)31 b([4)o(].)f(While)h(these)h
(two)f(works)h(can)e(be)h(r)o(ead)e(without)j(r)o(eading)e(this)i
(tutorial,)p 523 4746 473 4 v 558 4801 a Ff(5)606 4833
y Fo(Not)22 b(to)g(mention)h(the)g(century-long)e(\223stages\224)h
(that)i(wer)o(e)d(needed)g(to)h(evolve)g(the)g(theory)g(be-)606
4924 y(hind)d(many)g(of)g(these)f(libraries.)1922 5173
y Fp(17)p eop
%%Page: 18 18
18 17 bop 523 448 a Fp(developing)26 b(a)f(full)g(appr)o(eciation)f(of)
i(the)f(ideas)g(they)h(discuss)g(r)o(equir)o(es)e(either)i(an)f(un-)523
548 y(derstanding)19 b(of)g(the)h(internals)f(of)h(partial)e
(evaluators)h(or)g(a)g(basic)g(grasp)g(of)g(multi-stage)523
648 y(computation.)i(This)h(tutorial)f(tries)f(to)i(pr)o(ovide)d(the)i
(latter)-6 b(.)648 747 y(Multi-stage)32 b(languages)i(ar)o(e)e(both)i
(a)f(special)g(case)g(of)g(meta-pr)o(ogramming)g(lan-)523
847 y(guages)25 b(and)g(a)f(generalization)h(of)g(multi-level)g(and)g
(two-level)g(languages.)g(T)-8 b(aha)25 b([14)n(])523
946 y(gives)20 b(de\002nitions)i(and)e(a)f(basic)h(classi\002cation)h
(for)f(these)g(notions.)i(Shear)o(d)c([12)o(])i(gives)g(a)523
1046 y(r)o(ecent)c(account)h(of)g(accomplishment)i(and)d(challenges)i
(in)f(meta-pr)o(ogramming.)g(While)523 1146 y(multi-stage)f(languages)g
(ar)o(e)e(\223only\224)i(a)f(special)g(case)g(of)h(meta-pr)o(ogramming)
f(languages,)523 1245 y(their)27 b(specialized)f(natur)o(e)g(has)g(a)h
(lot)g(of)g(advantages.)f(For)h(example,)f(it)h(is)g(possible)h(to)523
1345 y(formally)18 b(pr)o(ove)f(that)g(they)i(admit)e(str)o(ong)h
(algebraic)f(pr)o(operties,)f(even)i(in)g(the)g(untyped)523
1445 y(setting)h([15)o(].)f(Additionally)-9 b(,)18 b(signi\002cant)i
(advances)d(have)h(been)g(made)g(over)h(the)f(last)h(six)523
1544 y(years)k(in)h(static)g(typing)g(for)f(these)h(languages)g(\(c.f.)
e([18)n(]\).)h(It)h(will)g(be)f(inter)o(esting)h(to)g(see)523
1644 y(if)d(such)g(r)o(esults)f(can)h(be)f(attained)g(for)h(mor)o(e)f
(general)g(notions)j(of)d(meta-pr)o(ogramming.)648 1743
y(Finally)-9 b(,)24 b(the)g(MetaOCaml)f(web-site)g(will)i(be)f
(continually)h(updated)d(with)j(new)f(r)o(e-)523 1843
y(sear)o(ch)19 b(r)o(esults)h(and)g(academic)e(materials)i(r)o(elating)
f(to)i(multi-stage)f(pr)o(ogramming)g([9].)523 2029 y
Fk(Acknowledgments:)44 b Fp(I)23 b(would)g(like)g(to)h(thank)f(the)g
(participants)g(in)g(the)h(Dagstuhl)f(meet-)523 2129
y(ing,)29 b(especially)g(Charles)g(Consel,)g(Krzysztof)g(Czarnecki,)f
(Shriram)g(Krishnamurthy)-9 b(,)523 2228 y(David)17 b(W)-5
b(ile,)17 b(T)-8 b(odd)17 b(V)-9 b(eldhizen,)17 b(Paul)g(Kelly)-9
b(,)17 b(Kevin)h(Hammond,)f(Chris)h(Lengauer)-6 b(,)15
b(and)523 2328 y(Y)-8 b(annis)32 b(Smaragdakis)d(for)h(valuable)g
(discussions,)h(and)f(Stephan)g(Ellner)h(and)f(Kedar)523
2427 y(Swadi)20 b(for)h(car)o(eful)e(pr)o(oof-r)o(eading)f(of)j(a)f
(draft.)523 2680 y Fl(References)560 2854 y Fo(1.)44
b(C)t Fb(A)t(L)t(C)t(A)t(G)t(N)t(O)t Fo(,)17 b(C)t(.)t(,)k(T)o
Fb(A)t(H)t(A)t Fo(,)d(W)m(.)t(,)j(H)t Fb(U)t(A)t(N)t(G)t
Fo(,)d(L)t(.)t(,)i Fb(A)t(N)t(D)h Fo(L)t Fb(E)t(R)t(O)t(Y)m
Fo(,)d(X)t(.)27 b(Implementing)17 b(multi-stage)658 2945
y(languages)g(using)g(asts,)h(gensym,)e(and)j(r)o(e\003ection.)24
b(In)18 b Fa(Generative)g(Pr)o(ogramming)g(and)f(Compo-)658
3037 y(nent)f(Engineering)f(\(GPCE\))g Fo(\(2003\),)j(K.)e(Czarnecki,)h
(F)-7 b(.)16 b(Pfenning,)g(and)i(Y)-8 b(.)15 b(Smaragdakis,)h(Eds.,)658
3128 y(Lectur)o(e)i(Notes)g(in)h(Computer)f(Science,)h(Springer)o(-V)-8
b(erlag.)560 3216 y(2.)44 b(C)t Fb(O)t(N)t(S)t(E)t(L)t
Fo(,)20 b(C)t(.)t(,)i Fb(A)t(N)t(D)h Fo(D)t Fb(A)t(N)t(V)t(Y)m
Fo(,)d(O)t(.)31 b(T)-7 b(utorial)19 b(notes)h(on)g(partial)g
(evaluation.)30 b(In)20 b Fa(ACM)f(Sympo-)658 3307 y(sium)f(on)h
(Principles)f(of)g(Pr)o(ogramming)h(Languages)g Fo(\(1993\),)g(pp.)f
(493\226501.)560 3395 y(3.)44 b(D)t Fb(A)t(N)t(V)t(Y)m
Fo(,)16 b(O)t(.)22 b(Semantics-dir)o(ected)14 b(compilation)i(of)f
(non-linear)h(patterns.)21 b(T)-7 b(echnical)17 b(Report)658
3487 y(303,)i(Indiana)h(University)-8 b(,)18 b(Bloomington,)f(Indiana,)
j(USA,)f(1990.)560 3575 y(4.)44 b(J)t Fb(O)t(N)t(E)t(S)t
Fo(,)29 b(N)t(.)h(D)t(.)56 b(What)28 b(not)g(to)g(do)e(when)j(writing)e
(an)h(interpr)o(eter)e(for)g(specialisation.)54 b(In)658
3666 y Fa(Partial)27 b(Evaluation)g Fo(\(1996\),)h(O.)f(Danvy)-8
b(,)27 b(R.)g(Gl)10 b(\250)-35 b(uck,)27 b(and)h(P)-10
b(.)28 b(Thiemann,)g(Eds.,)e(vol.)h(1110)i(of)658 3757
y Fa(Lectur)o(e)18 b(Notes)h(in)f(Computer)h(Science)p
Fo(,)f(Springer)o(-V)-8 b(erlag,)15 b(pp.)j(216\226237.)560
3845 y(5.)44 b(J)t Fb(O)t(N)t(E)t(S)t Fo(,)26 b(N)t(.)h(D)t(.)t(,)g(G)t
Fb(O)t(M)t(A)t(R)t(D)t Fo(,)e(C)t(.)i(K)t(.)t(,)g Fb(A)t(N)t(D)g
Fo(S)t Fb(E)t(S)t(T)s(O)t(F)t(T)o Fo(,)e(P)-6 b(.)47
b Fa(Partial)23 b(Evaluation)h(and)g(Automatic)658 3937
y(Pr)o(ogram)19 b(Generation)p Fo(.)26 b(Pr)o(entice-Hall,)18
b(1993.)560 4024 y(6.)44 b(L)t Fb(AW)o(A)t(L)t(L)t Fo(,)25
b(J)t(.)31 b(L)t(.)t(,)e Fb(A)t(N)t(D)h Fo(D)t Fb(A)t(N)t(V)t(Y)m
Fo(,)e(O)t(.)55 b(Continuation-based)28 b(partial)g(evaluation.)55
b(In)27 b Fa(1994)658 4116 y(ACM)35 b(Confer)o(ence)h(on)g(Lisp)g(and)g
(Functional)e(Pr)o(ogramming,)i(Orlando,)h(Florida,)e(June)g(1994)658
4207 y Fo(\(1994\),)20 b(New)e(Y)-7 b(ork:)18 b(ACM,)g(pp.)g
(227\226238.)560 4295 y(7.)44 b(L)t Fb(E)t(R)t(O)t(Y)m
Fo(,)130 b(X)t(.)383 b(Objective)130 b(Caml,)g(2000.)383
b(A)-7 b(vailable)130 b(fr)o(om)658 4386 y Fn
(http://caml.inria.fr/ocaml/)p Fo(.)560 4474 y(8.)42
b(Complete)81 b(sour)o(ce)g(code)g(for)h Fn(lint)f Fo(example.)228
b(A)-7 b(vailable)83 b(online)f(fr)o(om)658 4566 y Fn
(http://www.metaocaml.org/examples/lint.)o(ml)p Fo(,)12
b(2003.)560 4654 y(9.)42 b(MetaOCaml:)21 b(A)h(compiled,)e(type-safe)h
(multi-stage)g(pr)o(ogramming)f(language.)36 b(A)-7 b(vailable)658
4745 y(online)19 b(fr)o(om)e Fn(http://www.metaocaml.org/)p
Fo(,)d(2003.)523 4833 y(10.)42 b(The)20 b(MetaML)f(Home)g(Page,)h
(2000.)31 b(Pr)o(ovides)18 b(sour)o(ce)g(code)h(and)i(documentation)f
(online)g(at)658 4924 y Fn(http://www.cse.ogi.edu/PacSoft/projects)o
(/metam)o(l/inde)o(x.html)o Fo(.)1922 5173 y Fp(18)p
eop
%%Page: 19 19
19 18 bop 523 448 a Fo(11.)42 b(Or)o(egon)48 b(Graduate)i(Institute)h
(T)-7 b(echnical)51 b(Reports.)d(P)-10 b(.O.)50 b(Box)e(91000,)k
(Portland,)d(OR)658 540 y(97291-1000,USA.)145 b(A)-7
b(vailable)55 b(online)f(fr)o(om)f Fn(ftp://cse.ogi.edu/pub/tech-)658
631 y(reports/README.html)p Fo(.)523 722 y(12.)44 b(S)t
Fb(H)t(E)t(A)t(R)t(D)t Fo(,)37 b(T)n(.)85 b(Accomplishments)37
b(and)g(r)o(esear)o(ch)e(challenges)h(in)h(meta-pr)o(ogramming.)658
814 y(In)28 b Fa(Generative)g(Pr)o(ogramming)g(and)f(Component)h
(Engineer)e(SIGPLAN/SIGSOFT)f(Confer)o(ence,)658 905
y(GPCE)20 b(2002)i Fo(\(Oct.)f(2002\),)h(D.)f(Batory)-8
b(,)19 b(C.)i(Consel,)f(and)i(W)-7 b(.)20 b(T)-7 b(aha,)22
b(Eds.,)d(vol.)i(2487)h(of)f Fa(Lectur)o(e)658 996 y(Notes)e(in)f
(Computer)h(Science)p Fo(,)f(ACM,)g(Springer)-6 b(,)18
b(pp.)g(2\22644.)523 1088 y(13.)44 b(S)t Fb(H)t(E)t(A)t(R)t(D)t
Fo(,)30 b(T)n(.)t(,)i(B)t Fb(E)t(N)t(A)t(I)t(S)t(S)t(A)t
Fo(,)d(Z)t(.)j(E)t(.)t(-)t(A)t(.)t(,)e Fb(A)t(N)t(D)i
Fo(P)n Fb(A)2120 1081 y Fo(\020)2117 1088 y Fb(S)t(A)t(L)t(I)2277
1081 y Fo(\264)2268 1088 y Fb(C)t Fo(,)e(E)t(.)61 b(DSL)29
b(implementation)g(using)658 1179 y(staging)g(and)i(monads.)62
b(In)30 b Fa(Second)g(Confer)o(ence)f(on)g(Domain-Speci\002c)i
(Languages)e(\(DSL)m('99\))658 1270 y Fo(\(Austin,)19
b(T)-7 b(exas,)17 b(1999\),)j(USENIX.)523 1362 y(14.)44
b(T)o Fb(A)t(H)t(A)t Fo(,)20 b(W)m(.)31 b Fa(Multi-Stage)18
b(Pr)o(ogramming:)h(Its)g(Theory)i(and)e(Applications)p
Fo(.)30 b(PhD)19 b(thesis,)g(Or)o(egon)658 1453 y(Graduate)g(Institute)
g(of)g(Science)g(and)g(T)-7 b(echnology)f(,)17 b(1999.)28
b(A)-7 b(vailable)20 b(fr)o(om)d([11)q(].)523 1544 y(15.)44
b(T)o Fb(A)t(H)t(A)t Fo(,)17 b(W)m(.)24 b(A)17 b(sound)f(r)o(eduction)g
(semantics)h(for)e(untyped)i(CBN)f(multi-stage)g(computation.)658
1636 y(Or)-6 b(,)16 b(the)g(theory)g(of)g(MetaML)g(is)f(non-trivial.)22
b(In)17 b Fa(Pr)o(oceedings)f(of)g(the)h(W)o(orkshop)f(on)g(Partial)g
(Eval-)658 1727 y(uation)i(and)g(Semantics-Based)h(Pr)o(ogram)g
(Maniplation)e(\(PEPM\))g Fo(\(Boston,)h(2000\),)i(ACM)e(Pr)o(ess.)523
1818 y(16.)44 b(T)o Fb(A)t(H)t(A)t Fo(,)32 b(W)m(.)t(,)i
Fb(A)t(N)t(D)g Fo(M)t Fb(A)t(K)t(H)t(O)t(L)t(M)t Fo(,)d(H)t(.)68
b(T)-7 b(ag)31 b(elimination)h(\226)g(or)e(\226)i(type)f
(specialisation)g(is)g(a)658 1910 y(type-indexed)16 b(ef)o(fect.)23
b(In)c(Subtyping)e(and)h(Dependent)g(T)-7 b(ypes)17 b(in)g(Pr)o
(ogramming,)f(APPSEM)658 2001 y(W)-7 b(orkshop.)17 b(INRIA)i(technical)
h(r)o(eport,)d(2000.)523 2092 y(17.)44 b(T)o Fb(A)t(H)t(A)t
Fo(,)20 b(W)m(.)t(,)h(M)t Fb(A)t(K)t(H)t(O)t(L)t(M)t
Fo(,)e(H)t(.)t(,)j Fb(A)t(N)t(D)g Fo(H)t Fb(U)t(G)t(H)t(E)t(S)t
Fo(,)d(J)t(.)30 b(T)-7 b(ag)19 b(elimination)g(and)g(Jones-optimality)
-8 b(.)658 2183 y(In)17 b Fa(Pr)o(ograms)f(as)g(Data)g(Objects)g
Fo(\(2001\),)h(O.)e(Danvy)h(and)h(A.)e(Filinksi,)f(Eds.,)g(vol.)i(2053)
h(of)f Fa(Lectur)o(e)658 2275 y(Notes)j(in)f(Computer)h(Science)p
Fo(,)f(pp.)g(257\226275.)523 2366 y(18.)44 b(T)o Fb(A)t(H)t(A)t
Fo(,)31 b(W)m(.)t(,)h Fb(A)t(N)t(D)g Fo(N)t Fb(I)t(E)t(L)t(S)t(E)t(N)t
Fo(,)e(M)t(.)i(F)m(.)63 b(Envir)o(onment)30 b(classi\002ers.)60
b(In)31 b Fa(The)e(Symposium)h(on)658 2457 y(Principles)18
b(of)h(Pr)o(ogramming)f(Languages)h(\(POPL)f('03\))h
Fo(\(New)f(Orleans,)g(2003\).)523 2549 y(19.)44 b(T)o
Fb(A)t(H)t(A)t Fo(,)17 b(W)m(.)t(,)i Fb(A)t(N)t(D)g Fo(S)t
Fb(H)t(E)t(A)t(R)t(D)t Fo(,)f(T)n(.)23 b(Multi-stage)16
b(pr)o(ogramming)f(with)i(explicit)e(annotations.)24
b(In)658 2640 y Fa(Pr)o(oceedings)19 b(of)f(the)h(Symposium)g(on)f
(Partial)g(Evaluation)g(and)g(Semantic-Based)h(Pr)o(ogram)g(Manip-)658
2731 y(ulation)e(\(PEPM\))g Fo(\(Amster)o(dam,)h(1997\),)h(ACM)g(Pr)o
(ess,)e(pp.)h(203\226217.)1922 5173 y Fp(19)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
